<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é‹å‹•å³¶ Sports Island</title>

  <!-- Tailwindï¼ˆç›®å‰å¯ç”¨ï¼Œè­¦å‘Šå¯å¿½ç•¥ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- LIFF -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { background:#f5f6f8; }
    .view { display:none; }
    .view.active { display:block; }
  </style>
</head>

<body class="min-h-screen flex justify-center">

<div class="w-full max-w-md bg-white min-h-screen flex flex-col relative">

  <!-- Header -->
  <header class="p-4 border-b flex justify-between items-center">
    <h1 class="font-black text-lg">é‹å‹•å³¶ 2026</h1>
    <img id="userAvatar" class="w-8 h-8 rounded-full" />
  </header>

  <!-- Views -->
  <main class="flex-grow pb-24">

    <!-- æ´»å‹• -->
    <section id="view-index" class="view active p-4 space-y-4">
      <div id="courseContainer" class="space-y-4 text-center text-slate-400">
        è¼‰å…¥ä¸­â€¦
      </div>
    </section>

    <!-- ç´€éŒ„ -->
    <section id="view-query" class="view p-4 space-y-4">
      <div id="historyContainer" class="text-center text-slate-400">
        å°šç„¡ç´€éŒ„
      </div>
    </section>

    <!-- æœƒå“¡ -->
    <section id="view-member" class="view p-4 space-y-4">
      <h2 id="userName" class="font-black text-lg"></h2>
      <div id="familyList" class="space-y-3"></div>
    </section>

  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md bg-white border-t flex justify-around py-2">
    <button onclick="switchView('index')" class="font-bold">ğŸ  æ´»å‹•</button>
    <button onclick="switchView('query')" class="font-bold">ğŸ“„ ç´€éŒ„</button>
    <button onclick="switchView('member')" class="font-bold">ğŸ‘¤ æœƒå“¡</button>
  </nav>

</div>

<script>
/* =====================================================
 * å…¨åŸŸè¨­å®šï¼ˆåªå®£å‘Šä¸€æ¬¡ï¼Œé¿å…è¡çªï¼‰
 * ===================================================== */
const API_URL = "https://sport.wetw-net3.workers.dev/";

/* =====================================================
 * ç‹€æ…‹
 * ===================================================== */
let currentUid = "";
let courseList = [];

/* =====================================================
 * åˆå§‹åŒ–
 * ===================================================== */
async function init() {
  await liff.init({ liffId: "2008792551-CzPJtVB1" });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  const profile = await liff.getProfile();
  currentUid = profile.userId;

  document.getElementById("userAvatar").src = profile.pictureUrl;
  document.getElementById("userName").innerText = "æ‚¨å¥½ï¼Œ" + profile.displayName;

  loadCourses();
}

/* =====================================================
 * åˆ‡æ›ç•«é¢
 * ===================================================== */
function switchView(v) {
  document.querySelectorAll(".view").forEach(el => el.classList.remove("active"));
  document.getElementById("view-" + v).classList.add("active");

  if (v === "query") loadHistory();
  if (v === "member") loadFamily();
}

/* =====================================================
 * è¼‰å…¥èª²ç¨‹ï¼ˆğŸ”¥ åƒ¹æ ¼å·²ä¿®æ­£ï¼‰
 * ===================================================== */
async function loadCourses() {
  const box = document.getElementById("courseContainer");
  box.innerHTML = "";

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "getCourses" })
  }).then(r => r.json());

  courseList = res.data || [];

  if (!courseList.length) {
    box.innerHTML = "ç›®å‰ç„¡èª²ç¨‹";
    return;
  }

  box.innerHTML = courseList.map((c, i) => `
    <div class="p-4 rounded-xl border bg-slate-50">
      <div class="font-black">${c.åç¨±}</div>
      <div class="text-xs text-slate-400">${c.é–‹å§‹} ï½ ${c.çµæŸ}</div>
      <div class="text-green-600 font-black mt-2">
        $${Number(c.åƒ¹æ ¼ || 0).toLocaleString()}
      </div>
      <button class="mt-3 w-full bg-green-600 text-white py-2 rounded-xl font-bold"
        onclick="alert('ä¸‹ä¸€æ­¥æ¥å ±åæµç¨‹')">
        å ±å
      </button>
    </div>
  `).join("");
}

/* =====================================================
 * æ­·å²ç´€éŒ„
 * ===================================================== */
async function loadHistory() {
  const box = document.getElementById("historyContainer");
  box.innerHTML = "è¼‰å…¥ä¸­â€¦";

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "getUserRegistrations", userId: currentUid })
  }).then(r => r.json());

  const list = res.data || [];
  if (!list.length) {
    box.innerHTML = "å°šç„¡ç´€éŒ„";
    return;
  }

  box.innerHTML = list.map(r => `
    <div class="p-4 border rounded-xl">
      <div class="font-bold">${r.èª²ç¨‹}</div>
      <div class="text-xs text-slate-400">${r.æ—¥æœŸ}</div>
      <div class="font-black mt-1">$${Number(r.é‡‘é¡ || 0).toLocaleString()}</div>
    </div>
  `).join("");
}

/* =====================================================
 * å®¶åº­æˆå“¡
 * ===================================================== */
async function loadFamily() {
  const box = document.getElementById("familyList");
  box.innerHTML = "è¼‰å…¥ä¸­â€¦";

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "getFamily", userId: currentUid })
  }).then(r => r.json());

  const list = res.data || [];
  if (!list.length) {
    box.innerHTML = "å°šç„¡å­¸å“¡";
    return;
  }

  box.innerHTML = list.map(f => `
    <div class="p-3 border rounded-xl flex justify-between">
      <div>
        <div class="font-bold">${f.name}</div>
        <div class="text-xs text-slate-400">${f.relation}</div>
      </div>
    </div>
  `).join("");
}

window.onload = init;
</script>

</body>
</html>
