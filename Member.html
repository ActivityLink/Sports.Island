<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é‹å‹•å³¶ Sports Island</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont; }
    #debugPanel {
      position: fixed;
      right: 12px;
      bottom: 12px;
      width: 280px;
      max-height: 50vh;
      overflow-y: auto;
      background: rgba(0,0,0,.85);
      color: #fff;
      font-size: 12px;
      padding: 12px;
      border-radius: 12px;
      z-index: 9999;
      line-height: 1.5;
    }
    #debugPanel h3 {
      font-weight: 800;
      margin-bottom: 6px;
      color: #4ade80;
    }
    #debugPanel .ok { color:#4ade80; }
    #debugPanel .err { color:#f87171; }
    #debugPanel .info { color:#93c5fd; }
  </style>
</head>

<body class="bg-slate-100 min-h-screen flex justify-center">

<!-- ================= Debug Panel ================= -->
<div id="debugPanel">
  <h3>ğŸ›  Debug Panel</h3>
  <div id="dbg-js">JSï¼š<span class="err">æœªå•Ÿå‹•</span></div>
  <div id="dbg-api">APIï¼š-</div>
  <div id="dbg-liff">LIFFï¼š-</div>
  <div id="dbg-user">Userï¼š-</div>
  <div id="dbg-log" class="mt-2 text-slate-300"></div>
</div>

<!-- ================= App ================= -->
<div class="w-full max-w-md bg-white min-h-screen shadow-xl flex flex-col">

  <header class="p-4 border-b flex justify-between items-center">
    <h1 class="font-black text-lg">é‹å‹•å³¶ 2026</h1>
    <span id="userName" class="text-sm text-slate-400">å°šæœªç™»å…¥</span>
  </header>

  <main class="flex-grow p-4 space-y-4">

    <button onclick="loadCourses()"
      class="w-full bg-emerald-600 text-white py-4 rounded-xl font-black">
      è®€å–èª²ç¨‹
    </button>

    <button onclick="loadFamily()"
      class="w-full bg-indigo-600 text-white py-4 rounded-xl font-black">
      è®€å–æœƒå“¡
    </button>

    <div id="output" class="text-sm bg-slate-50 p-3 rounded-xl"></div>

  </main>

</div>

<script>
/* =====================================================
 * â‘  å…¨åŸŸå”¯ä¸€ API_URLï¼ˆâš ï¸åªæ­¤ä¸€æ¬¡ï¼‰
 * ===================================================== */
const API_URL = window.location.origin + "/";

/* =====================================================
 * â‘¡ Debug å·¥å…·
 * ===================================================== */
const dbg = {
  log(msg, type='info') {
    const el = document.getElementById('dbg-log');
    const div = document.createElement('div');
    div.className = type;
    div.textContent = msg;
    el.prepend(div);
  },
  set(id, text, ok=true) {
    const el = document.getElementById(id);
    el.innerHTML = el.innerHTML.split('ï¼š')[0] + 'ï¼š' +
      `<span class="${ok?'ok':'err'}">${text}</span>`;
  }
};

/* =====================================================
 * â‘¢ JS å•Ÿå‹•ç¢ºèª
 * ===================================================== */
dbg.set('dbg-js', 'å·²å•Ÿå‹•');
dbg.set('dbg-api', API_URL);

/* =====================================================
 * â‘£ LIFF åˆå§‹åŒ–
 * ===================================================== */
let currentUid = "";

async function initLIFF() {
  try {
    dbg.log('LIFF init start');
    await liff.init({ liffId: "2008792551-CzPJtVB1" });

    if (!liff.isLoggedIn()) {
      dbg.set('dbg-liff', 'æœªç™»å…¥', false);
      liff.login();
      return;
    }

    const profile = await liff.getProfile();
    currentUid = profile.userId;

    document.getElementById('userName').innerText = profile.displayName;
    dbg.set('dbg-liff', 'OK');
    dbg.set('dbg-user', profile.userId.slice(0,6)+'â€¦');

  } catch (e) {
    dbg.set('dbg-liff', 'å¤±æ•—', false);
    dbg.log('LIFF Error: '+e.message, 'err');
  }
}

/* =====================================================
 * â‘¤ API å‘¼å«å°è£
 * ===================================================== */
async function post(action, payload={}) {
  dbg.log('POST '+action);
  const res = await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type':'application/json' },
    body: JSON.stringify({ action, ...payload })
  });
  return res.json();
}

/* =====================================================
 * â‘¥ åŠŸèƒ½ï¼šè¼‰å…¥èª²ç¨‹
 * ===================================================== */
async function loadCourses() {
  try {
    const res = await post('getCourses');
    document.getElementById('output').innerText =
      JSON.stringify(res, null, 2);
    dbg.log('Courses loaded');
  } catch (e) {
    dbg.log('Courses error', 'err');
  }
}

/* =====================================================
 * â‘¦ åŠŸèƒ½ï¼šè¼‰å…¥æœƒå“¡
 * ===================================================== */
async function loadFamily() {
  if (!currentUid) {
    dbg.log('å°šæœªå–å¾— userId', 'err');
    return;
  }
  try {
    const res = await post('getFamily', { userId: currentUid });
    document.getElementById('output').innerText =
      JSON.stringify(res, null, 2);
    dbg.log('Family loaded');
  } catch (e) {
    dbg.log('Family error', 'err');
  }
}

/* =====================================================
 * â‘§ å•Ÿå‹•
 * ===================================================== */
window.onload = initLIFF;
</script>

</body>
</html>
