<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>é‹å‹•å³¶ 2026</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
.view { display:none; }
.view.active { display:block; }

.modal {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}
.modal.active{ display:flex; }
</style>
</head>

<body class="bg-slate-100 min-h-screen flex justify-center">

<div class="w-full max-w-md bg-white min-h-screen flex flex-col">

<!-- ===== Header + Banner ===== -->
<header class="border-b">
  <div class="p-4 flex justify-between items-center">
    <h1 class="font-black text-xl">é‹å‹•å³¶ 2026</h1>
    <img id="userAvatar" class="w-10 h-10 rounded-full bg-slate-200">
  </div>
  <img
    src="https://aiwe.cc/wp-content/uploads/2025/12/3486bc19dc6317e16bf4f1449ec52ae4.jpg"
    class="w-full object-cover"
  >
</header>

<!-- ===== Main Views ===== -->
<main class="flex-1 overflow-y-auto pb-24">

<!-- æ´»å‹• -->
<section id="view-activity" class="view active p-4 space-y-4">
  <div id="courseList" class="text-slate-400 text-sm">è¼‰å…¥æ´»å‹•ä¸­â€¦</div>
</section>

<!-- ç´€éŒ„ -->
<section id="view-record" class="view p-4 space-y-4">
  <div id="recordList" class="text-slate-400 text-sm">è¼‰å…¥ç´€éŒ„ä¸­â€¦</div>
</section>

<!-- æœƒå“¡ -->
<section id="view-member" class="view p-4 space-y-3">
  <h2 class="text-sm font-bold text-slate-400">æœƒå“¡åå–®</h2>
  <div id="familyList" class="space-y-3 text-sm text-slate-400">è¼‰å…¥ä¸­â€¦</div>
</section>

</main>

<!-- ===== Bottom Nav ===== -->
<nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md bg-white border-t h-16 flex justify-around items-center text-xs font-bold">
  <button onclick="switchView('activity')" class="flex flex-col items-center">
    ğŸ <span>æ´»å‹•</span>
  </button>
  <button onclick="switchView('record')" class="flex flex-col items-center">
    ğŸ“„<span>ç´€éŒ„</span>
  </button>
  <button onclick="switchView('member')" class="flex flex-col items-center">
    ğŸ‘¤<span>æœƒå“¡</span>
  </button>
</nav>

</div>

<!-- ===== Edit Modal ===== -->
<div id="editModal" class="modal">
  <div class="bg-white w-full max-w-sm rounded-2xl p-6 space-y-4">
    <h3 class="font-black text-lg">ç·¨è¼¯å­¸å“¡</h3>
    <input id="editName" class="w-full p-3 border rounded-xl">
    <input id="editPhone" class="w-full p-3 border rounded-xl">
    <select id="editRelation" class="w-full p-3 border rounded-xl">
      <option>æœ¬äºº</option><option>å­å¥³</option><option>å…¶ä»–</option>
    </select>
    <div class="flex space-x-2">
      <button onclick="closeModal()" class="flex-1 py-3 bg-slate-200 rounded-xl font-bold">å–æ¶ˆ</button>
      <button onclick="saveMember()" class="flex-1 py-3 bg-green-600 text-white rounded-xl font-bold">å„²å­˜</button>
    </div>
  </div>
</div>

<script>
const API_URL = "https://sport.wetw-net3.workers.dev/";
let uid="", family=[], editIdx=null;

/* View */
function switchView(v){
  document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
  document.getElementById('view-'+v).classList.add('active');
}

/* Init */
async function init(){
  await liff.init({ liffId:"2008792551-CzPJtVB1" });
  if(!liff.isLoggedIn()){ liff.login(); return; }
  const p = await liff.getProfile();
  uid=p.userId; userAvatar.src=p.pictureUrl;
  loadFamily();
}

/* Family */
async function loadFamily(){
  const box=familyList;
  const r=await fetch(API_URL,{method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({action:"getFamily",userId:uid})});
  const j=await r.json(); family=j.data||[];
  if(!family.length){ box.innerHTML="å°šç„¡æœƒå“¡"; return; }
  box.innerHTML=family.map((f,i)=>`
    <div class="border rounded-2xl p-4 flex justify-between items-center">
      <div>
        <div class="font-bold text-slate-800">${f.name}</div>
        <div class="text-xs text-slate-400">${f.phone}ï½œ${f.relation}</div>
      </div>
      <button onclick="openEdit(${i})" class="px-3 py-1.5 border rounded-lg text-xs">âœï¸ ç·¨è¼¯</button>
    </div>`).join("");
}

function openEdit(i){
  editIdx=i;
  const f=family[i];
  editName.value=f.name;
  editPhone.value=f.phone;
  editRelation.value=f.relation;
  editModal.classList.add("active");
}
function closeModal(){ editModal.classList.remove("active"); }

async function saveMember(){
  const f=family[editIdx];
  await fetch(API_URL,{method:"POST",headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      action:"updateFamily",
      userId:uid,
      oldName:f.name,
      oldPhone:f.phone,
      name:editName.value,
      phone:editPhone.value,
      relation:editRelation.value
    })});
  closeModal(); loadFamily();
}

window.onload=init;
</script>
</body>
</html>
