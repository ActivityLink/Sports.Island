<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é‹å‹•å³¶ Sports Island</title>

  <!-- Tailwindï¼ˆç›®å‰ç¶­æŒ CDNï¼Œä¹‹å¾Œå¯æ›æ­£å¼ç·¨è­¯ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- LIFF -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { background:#f4f5f7; }
    .view { display:none; }
    .view.active { display:block; }
  </style>
</head>

<body class="min-h-screen flex justify-center">

<div class="w-full max-w-md bg-white min-h-screen flex flex-col shadow-xl relative">

  <!-- ğŸ”° BANNERï¼ˆå·²æ¢å¾©ï¼‰ -->
  <div class="relative">
    <img
      src="https://aiwe.cc/wp-content/uploads/2025/12/3486bc19dc6317e16bf4f1449ec52ae4.jpg"
      class="w-full h-44 object-cover"
    />
    <div class="absolute bottom-4 left-4 text-white">
      <h1 class="text-2xl font-black drop-shadow">é‹å‹•å³¶ Sports Island</h1>
      <p class="text-sm opacity-90">2026 èª²ç¨‹å ±åå…¥å£</p>
    </div>
  </div>

  <!-- ===================== -->
  <!-- ä¸»å…§å®¹å€ -->
  <!-- ===================== -->
  <main class="flex-grow pb-28">

    <!-- âœ… èª²ç¨‹å…¥å£ï¼ˆé è¨­é¡¯ç¤ºï¼‰ -->
    <section id="view-course" class="view active p-5 space-y-4">
      <div id="courseList" class="space-y-4 text-center text-slate-400">
        èª²ç¨‹è¼‰å…¥ä¸­â€¦
      </div>
    </section>

    <!-- âœ… å ±åç´€éŒ„ -->
    <section id="view-record" class="view p-5 space-y-4">
      <div id="recordList" class="text-center text-slate-400">
        å°šç„¡ç´€éŒ„
      </div>
    </section>

    <!-- âœ… æœƒå“¡ä¸­å¿ƒ -->
    <section id="view-member" class="view p-5 space-y-4">
      <div class="flex justify-between items-center">
        <h2 class="text-xl font-black">æˆ‘çš„å­¸å“¡</h2>
        <button
          onclick="openMemberForm()"
          class="px-4 py-2 bg-green-600 text-white rounded-xl font-bold"
        >
          + æ–°å¢å®¶äºº
        </button>
      </div>

      <div id="memberList" class="space-y-3 text-slate-400 text-center">
        è¼‰å…¥ä¸­â€¦
      </div>
    </section>

    <!-- âœ… æœƒå“¡è¡¨å–®ï¼ˆåƒ…éœ€è¦æ™‚é¡¯ç¤ºï¼‰ -->
    <section id="view-member-form" class="view p-5">
      <h2 class="text-xl font-black mb-4">å­¸å“¡è³‡æ–™</h2>

      <form id="memberForm" class="space-y-4">
        <input id="mName" placeholder="å§“å" class="w-full p-3 rounded-xl bg-slate-100" required />

        <select id="mIdentity" class="w-full p-3 rounded-xl bg-slate-100">
          <option value="ä¸€èˆ¬èº«åˆ†">ä¸€èˆ¬èº«åˆ†</option>
          <option value="å­¸ç”Ÿ">å­¸ç”Ÿ</option>
        </select>

        <select id="mGender" class="w-full p-3 rounded-xl bg-slate-100">
          <option value="ç”·">ç”·</option>
          <option value="å¥³">å¥³</option>
        </select>

        <input id="mBirthday" type="date" class="w-full p-3 rounded-xl bg-slate-100" />

        <input id="mPhone" placeholder="è¯çµ¡é›»è©±" class="w-full p-3 rounded-xl bg-slate-100" />

        <!-- âœ… å®Œæ•´ç¸£å¸‚ -->
        <select id="mArea" class="w-full p-3 rounded-xl bg-slate-100">
          <option value="">å±…ä½åœ°å€</option>
          <option>å°åŒ—å¸‚</option><option>æ–°åŒ—å¸‚</option><option>æ¡ƒåœ’å¸‚</option>
          <option>å°ä¸­å¸‚</option><option>å°å—å¸‚</option><option>é«˜é›„å¸‚</option>
          <option>æ–°ç«¹ç¸£</option><option>æ–°ç«¹å¸‚</option><option>è‹—æ —ç¸£</option>
          <option>å½°åŒ–ç¸£</option><option>å—æŠ•ç¸£</option><option>é›²æ—ç¸£</option>
          <option>å˜‰ç¾©ç¸£</option><option>å˜‰ç¾©å¸‚</option><option>å±æ±ç¸£</option>
          <option>å®œè˜­ç¸£</option><option>èŠ±è“®ç¸£</option><option>å°æ±ç¸£</option>
          <option>æ¾æ¹–ç¸£</option><option>é‡‘é–€ç¸£</option><option>é€£æ±Ÿç¸£</option>
        </select>

        <select id="mRelation" class="w-full p-3 rounded-xl bg-slate-100">
          <option value="æœ¬äºº">æœ¬äºº</option>
          <option value="å­å¥³">å­å¥³</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>

        <button
          type="submit"
          class="w-full py-4 bg-green-600 text-white rounded-xl font-black"
        >
          å„²å­˜å­¸å“¡
        </button>
      </form>
    </section>

  </main>

  <!-- ===================== -->
  <!-- ä¸‹æ–¹å°è¦½åˆ—ï¼ˆæ°¸é å­˜åœ¨ï¼‰ -->
  <!-- ===================== -->
  <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md bg-white border-t flex justify-around py-3">
    <button onclick="switchView('course')" class="font-bold">ğŸ“˜ èª²ç¨‹</button>
    <button onclick="switchView('record')" class="font-bold">ğŸ§¾ ç´€éŒ„</button>
    <button onclick="switchView('member')" class="font-bold">ğŸ‘¤ æœƒå“¡</button>
  </nav>

</div>

<script>
/* ===============================
 * å…¨åŸŸè¨­å®š
 * =============================== */
const API_URL = "https://sport.wetw-net3.workers.dev/";
let currentUserId = "";
let familyData = [];

/* ===============================
 * LIFF åˆå§‹åŒ–
 * =============================== */
async function init() {
  await liff.init({ liffId: "2008792551-CzPJtVB1" });
  if (!liff.isLoggedIn()) liff.login();

  const profile = await liff.getProfile();
  currentUserId = profile.userId;

  loadCourses();
}

/* ===============================
 * View åˆ‡æ›
 * =============================== */
function switchView(name) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + name).classList.add('active');

  if (name === 'member') loadMembers();
}

/* ===============================
 * èª²ç¨‹
 * =============================== */
async function loadCourses() {
  const res = await fetch(API_URL, {
    method:'POST',
    body: JSON.stringify({ action:'getCourses' })
  }).then(r=>r.json());

  const list = document.getElementById('courseList');
  list.innerHTML = res.data.map(c => `
    <div class="p-4 bg-slate-50 rounded-xl text-left">
      <div class="font-black">${c.åç¨±}</div>
      <div class="text-sm text-slate-500">${c.é–‹å§‹} ~ ${c.çµæŸ}</div>
    </div>
  `).join('');
}

/* ===============================
 * æœƒå“¡
 * =============================== */
async function loadMembers() {
  const res = await fetch(API_URL,{
    method:'POST',
    body:JSON.stringify({ action:'getFamily', userId:currentUserId })
  }).then(r=>r.json());

  familyData = res.data || [];
  const box = document.getElementById('memberList');

  if (!familyData.length) {
    box.innerHTML = 'å°šæœªå»ºç«‹å­¸å“¡';
    return;
  }

  box.innerHTML = familyData.map(f=>`
    <div class="p-4 bg-slate-50 rounded-xl text-left">
      <div class="font-black">${f.name}</div>
      <div class="text-xs text-slate-500">${f.relation}ï½œ${f.phone}</div>
    </div>
  `).join('');
}

function openMemberForm(){
  switchView('member-form');
}

/* ===============================
 * è¡¨å–®é€å‡º
 * =============================== */
document.getElementById('memberForm').onsubmit = async e => {
  e.preventDefault();

  await fetch(API_URL,{
    method:'POST',
    body:JSON.stringify({
      action:'saveFamily',
      userId:currentUserId,
      name:mName.value,
      gender:mGender.value,
      birthday:mBirthday.value,
      phone:mPhone.value,
      address:mArea.value,
      relation:mRelation.value
    })
  });

  switchView('member');
};

window.onload = init;
</script>

</body>
</html>
