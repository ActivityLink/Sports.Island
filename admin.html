<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‹å‹•å³¶ - ç®¡ç†å¾Œå°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #f8fafc; font-family: sans-serif; }
    .sidebar-active { background-color: #eff6ff; color: #2563eb; border-right: 4px solid #2563eb; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
  </style>
</head>
<body class="flex min-h-screen">

  <!-- å´é‚Šé¸å–® -->
  <aside class="w-64 bg-white border-r border-slate-200 hidden md:flex flex-col">
    <div class="p-6 border-b border-slate-100">
      <h1 class="text-xl font-black text-indigo-600 italic">SI ADMIN</h1>
      <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Management System</p>
    </div>
    <nav class="flex-grow py-4">
      <button onclick="switchTab('courses')" id="tab-courses" class="w-full text-left px-6 py-4 text-sm font-bold flex items-center sidebar-active">
        <span class="mr-3">ğŸ“š</span> èª²ç¨‹ç®¡ç†
      </button>
      <button onclick="switchTab('registrations')" id="tab-registrations" class="w-full text-left px-6 py-4 text-sm font-bold flex items-center text-slate-500 hover:bg-slate-50 transition-all">
        <span class="mr-3">ğŸ“</span> å ±ååå–®
      </button>
    </nav>
  </aside>

  <!-- ä¸»è¦å…§å®¹å€ -->
  <main class="flex-grow p-8">
    
    <!-- èª²ç¨‹ç®¡ç†å€å¡Š -->
    <section id="section-courses">
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-2xl font-black text-slate-800">èª²ç¨‹ç®¡ç†ä¸­å¿ƒ</h2>
          <p class="text-sm text-slate-400">ç¬¦åˆ 2026 ç³»çµ±æ‰‹å†Šè¦æ ¼ä¹‹èª²ç¨‹ç·¨ä¿®</p>
        </div>
        <button onclick="openCourseModal()" class="bg-indigo-600 text-white px-6 py-2.5 rounded-xl font-bold text-sm shadow-lg hover:bg-indigo-700 transition-all">
          + æ–°å¢èª²ç¨‹
        </button>
      </div>

      <div class="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse min-w-[800px]">
            <thead>
              <tr class="bg-slate-50 border-b border-slate-100 text-[10px] uppercase font-black text-slate-400">
                <th class="px-6 py-4">èª²ç¨‹ ID</th>
                <th class="px-6 py-4">é¡åˆ¥</th>
                <th class="px-6 py-4">èª²ç¨‹åç¨± / è² è²¬æ•™ç·´</th>
                <th class="px-6 py-4">ä¸Šèª²æ—¥æœŸ</th>
                <th class="px-6 py-4">åƒ¹æ ¼ / é™é¡</th>
                <th class="px-6 py-4">ç‹€æ…‹</th>
                <th class="px-6 py-4 text-right">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="courseTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- å ±åæ¸…å–®å€å¡Š (ç•¥ï¼Œç¶­æŒåŸæ¨£) -->
    <section id="section-registrations" class="hidden">
      <div class="mb-8">
        <h2 class="text-2xl font-black text-slate-800">å ±åæ•¸æ“šç›£æ§</h2>
      </div>
      <div id="regTableContainer" class="bg-white rounded-3xl shadow-sm border border-slate-100">
        <table class="w-full text-left"><tbody id="regTableBody"></tbody></table>
      </div>
    </section>
  </main>

  <!-- èª²ç¨‹ç·¨ä¿®è¦–çª— (è¦æ ¼åŒ– Modal) -->
  <div id="courseModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden items-center justify-center p-6 z-50 overflow-y-auto">
    <div class="bg-white w-full max-w-2xl rounded-[2.5rem] p-10 shadow-2xl relative my-8">
      <h3 id="modalTitle" class="text-2xl font-black text-slate-800 mb-6">èª²ç¨‹è¦æ ¼è¨­å®š</h3>
      
      <form id="courseForm" class="space-y-6">
        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">èª²ç¨‹å”¯ä¸€ ID</label>
            <input type="text" id="cId" placeholder="ä¾‹å¦‚: A01" required class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-indigo-500">
          </div>
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">èª²ç¨‹é¡åˆ¥</label>
            <select id="cCategory" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none">
              <option value="å–®æ—¥">å–®æ—¥èª²ç¨‹</option>
              <option value="æ¢¯æ¬¡">æ¢¯æ¬¡èª²ç¨‹</option>
              <option value="ç‡ŸéšŠå°ˆå€">ç‡ŸéšŠå°ˆå€</option>
              <option value="èª²å¾Œç­">èª²å¾Œç­</option>
            </select>
          </div>
        </div>

        <div>
          <label class="text-[10px] font-black text-slate-400 uppercase ml-1">èª²ç¨‹å…¨å</label>
          <input type="text" id="cName" placeholder="è«‹è¼¸å…¥å®Œæ•´èª²ç¨‹æ¨™é¡Œ" required class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-indigo-500">
        </div>

        <div class="grid grid-cols-2 gap-6">
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">è² è²¬æ•™ç·´ (å¤šä½è«‹ç”¨é€—è™Ÿ)</label>
            <input type="text" id="cCoach" placeholder="ä¾‹å¦‚: ç‹æ•™ç·´, Sarahè€å¸«" required class="w-full p-4 bg-slate-50 rounded-2xl border-none">
          </div>
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">ä¸Šèª²æ—¥æœŸ / å€æ®µ</label>
            <input type="text" id="cDates" placeholder="ä¾‹å¦‚: 2026/02/01 - 02/05" required class="w-full p-4 bg-slate-50 rounded-2xl border-none">
          </div>
        </div>

        <div class="grid grid-cols-3 gap-6">
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">èª²ç¨‹åŸåƒ¹</label>
            <input type="number" id="cPrice" placeholder="600" required class="w-full p-4 bg-slate-50 rounded-2xl border-none">
          </div>
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">æ‹›ç”Ÿäººæ•¸ä¸Šé™</label>
            <input type="number" id="cLimit" placeholder="20" required class="w-full p-4 bg-slate-50 rounded-2xl border-none">
          </div>
          <div>
            <label class="text-[10px] font-black text-slate-400 uppercase ml-1">ç›®å‰ç‹€æ…‹</label>
            <select id="cStatus" class="w-full p-4 bg-slate-50 rounded-2xl border-none shadow-sm">
              <option value="å ±åä¸­">å ±åä¸­</option>
              <option value="å·²é¡æ»¿">å·²é¡æ»¿</option>
              <option value="åœè¾¦">åœè¾¦</option>
            </select>
          </div>
        </div>

        <div class="flex space-x-3 pt-4">
          <button type="submit" id="saveBtn" class="flex-grow bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-xl hover:bg-indigo-700 active:scale-95 transition-all">å„²å­˜è‡³é›²ç«¯</button>
          <button type="button" onclick="closeCourseModal()" class="px-8 bg-slate-100 text-slate-400 py-4 rounded-2xl font-bold">å–æ¶ˆ</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const API_URL = "https://sport.wetw-net3.workers.dev/";
    let allCourses = [];

    async function fetchData() {
      try {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'adminGetCourses' }) });
        const json = await res.json();
        allCourses = json.data || [];
        renderCourseTable();
      } catch (e) { console.error("è³‡æ–™è¼‰å…¥å¤±æ•—"); }
    }

    function renderCourseTable() {
      const tbody = document.getElementById('courseTableBody');
      tbody.innerHTML = allCourses.map((c, i) => `
        <tr class="border-b border-slate-50 text-sm hover:bg-slate-50/50">
          <td class="px-6 py-4 text-slate-400 font-mono text-xs">${c.id}</td>
          <td class="px-6 py-4"><span class="bg-indigo-50 text-indigo-600 px-2 py-1 rounded text-[10px] font-bold">${c.category}</span></td>
          <td class="px-6 py-4">
            <div class="font-bold text-slate-700">${c.name}</div>
            <div class="text-[10px] text-slate-400 font-bold uppercase">Coach: ${c.coach}</div>
          </td>
          <td class="px-6 py-4 text-xs text-slate-500">${c.dates}</td>
          <td class="px-6 py-4">
            <div class="font-black text-slate-700">$${c.price}</div>
            <div class="text-[10px] text-slate-400 font-bold">Limit: ${c.limit}</div>
          </td>
          <td class="px-6 py-4">
            <span class="${c.status === 'å ±åä¸­' ? 'text-green-500' : 'text-slate-300'} text-[10px] font-black italic underline underline-offset-4">${c.status}</span>
          </td>
          <td class="px-6 py-4 text-right">
            <button onclick="editCourse(${i})" class="text-indigo-600 font-bold hover:underline">ç·¨è¼¯</button>
          </td>
        </tr>
      `).join('');
    }

    function openCourseModal() {
      document.getElementById('courseForm').reset();
      document.getElementById('cId').disabled = false;
      document.getElementById('courseModal').classList.replace('hidden', 'flex');
    }

    function closeCourseModal() {
      document.getElementById('courseModal').classList.replace('flex', 'hidden');
    }

    function editCourse(index) {
      const c = allCourses[index];
      document.getElementById('cId').value = c.id;
      document.getElementById('cId').disabled = true; // é–å®š ID
      document.getElementById('cCategory').value = c.category;
      document.getElementById('cName').value = c.name;
      document.getElementById('cCoach').value = c.coach;
      document.getElementById('cDates').value = c.dates;
      document.getElementById('cPrice').value = c.price;
      document.getElementById('cLimit').value = c.limit;
      document.getElementById('cStatus').value = c.status;
      document.getElementById('courseModal').classList.replace('hidden', 'flex');
    }

    document.getElementById('courseForm').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('saveBtn');
      btn.disabled = true; btn.innerText = "è³‡æ–™åŒæ­¥ä¸­...";
      
      const payload = {
        action: 'adminSaveCourse',
        id: document.getElementById('cId').value,
        category: document.getElementById('cCategory').value,
        name: document.getElementById('cName').value,
        coach: document.getElementById('cCoach').value,
        dates: document.getElementById('cDates').value,
        price: document.getElementById('cPrice').value,
        limit: document.getElementById('cLimit').value,
        status: document.getElementById('cStatus').value
      };

      try {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
        const json = await res.json();
        alert(json.msg);
        closeCourseModal();
        fetchData();
      } catch (e) { alert("å„²å­˜å¤±æ•—"); }
      finally { btn.disabled = false; btn.innerText = "å„²å­˜è‡³é›²ç«¯"; }
    };

    function switchTab(tab) {
      document.getElementById('section-courses').classList.toggle('hidden', tab !== 'courses');
      document.getElementById('section-registrations').classList.toggle('hidden', tab !== 'registrations');
      document.getElementById('tab-courses').className = tab === 'courses' ? 'w-full text-left px-6 py-4 text-sm font-bold flex items-center sidebar-active' : 'w-full text-left px-6 py-4 text-sm font-bold flex items-center text-slate-500 hover:bg-slate-50 transition-all';
      document.getElementById('tab-registrations').className = tab === 'registrations' ? 'w-full text-left px-6 py-4 text-sm font-bold flex items-center sidebar-active' : 'w-full text-left px-6 py-4 text-sm font-bold flex items-center text-slate-500 hover:bg-slate-50 transition-all';
    }

    window.onload = fetchData;
  </script>
</body>
</html>
