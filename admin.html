<!-- æª”æ¡ˆåç¨±ï¼šadmin.html (ç®¡ç†å¾Œå° - å°ˆæ¥­ SaaS ç°¡æ½”ç‰ˆ) -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é‹å‹•å³¶ç³»çµ± - ç®¡ç†ä¸­å¿ƒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
    body { background-color: #f8fafc; font-family: 'Inter', -apple-system, sans-serif; color: #1e293b; }
    
    /* å´é‚Šæ¬„æ¨£å¼ */
    .sidebar { background-color: #1e293b; width: 260px; }
    .sidebar-item { color: #94a3b8; transition: all 0.2s; }
    .sidebar-item:hover { color: #f8fafc; background-color: #334155; }
    .sidebar-item.active { background-color: #0f172a; color: #ffffff; border-right: 4px solid #10b981; }
    
    /* æ¨™ç±¤æ¨£å¼ - å–æ¶ˆå…¨ç²—é«” */
    .badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; letter-spacing: 0.025em; }
    .cat-å–®æ—¥ { background-color: #eff6ff; color: #3b82f6; }
    .cat-æ¢¯æ¬¡ { background-color: #ecfdf5; color: #10b981; }
    .cat-ç‡ŸéšŠ { background-color: #fff7ed; color: #f97316; }
    .cat-èª²å¾Œ { background-color: #f5f3ff; color: #8b5cf6; }

    /* è¼¸å…¥æ¡†æ¨£å¼å„ªåŒ– */
    .input-field { 
      width: 100%; padding: 10px 14px; background-color: #ffffff; 
      border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; 
      transition: all 0.2s; 
    }
    .input-field:focus { border-color: #10b981; outline: none; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
    .label-text { font-size: 11px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block; }

    /* å‹•ç•« */
    .slide-in { transform: translateX(100%); transition: transform 0.3s ease-out; }
    .slide-in.active { transform: translateX(0); }
  </style>
</head>
<body class="flex min-h-screen">

  <!-- å·¦å´å°è¦½åˆ— -->
  <aside class="sidebar flex flex-col fixed inset-y-0 left-0 z-50 shadow-xl">
    <div class="p-8 border-b border-slate-700 flex items-center space-x-3">
      <div class="w-8 h-8 bg-emerald-500 rounded-lg flex items-center justify-center text-white font-bold italic">SI</div>
      <div class="flex flex-col">
        <span class="text-white font-semibold text-base leading-none">é‹å‹•å³¶ä¸­å¿ƒ</span>
        <span class="text-slate-500 text-[10px] mt-1 font-medium tracking-widest uppercase">Admin System</span>
      </div>
    </div>
    <nav class="flex-grow py-8 px-4 space-y-2">
      <button onclick="switchTab('courses')" id="btn-courses" class="sidebar-item active w-full flex items-center px-4 py-3 rounded-lg text-sm font-medium">
        <span class="mr-3 opacity-60">ğŸ“</span> èª²ç¨‹è¦æ ¼ç®¡ç†
      </button>
      <button onclick="switchTab('stats')" id="btn-stats" class="sidebar-item w-full flex items-center px-4 py-3 rounded-lg text-sm font-medium">
        <span class="mr-3 opacity-60">ğŸ“Š</span> å ±åæ•¸æ“šæŸ¥è©¢
      </button>
      <button onclick="switchTab('settings')" id="btn-settings" class="sidebar-item w-full flex items-center px-4 py-3 rounded-lg text-sm font-medium">
        <span class="mr-3 opacity-60">âš™ï¸</span> ç³»çµ±åƒæ•¸è¨­å®š
      </button>
    </nav>
    <div class="p-6 text-[10px] text-slate-500 font-medium">VERSION 2026.01.V4</div>
  </aside>

  <!-- ä¸»å…§å®¹å€ -->
  <main class="flex-grow ml-[260px] p-12">
    
    <!-- A. èª²ç¨‹åˆ—è¡¨ -->
    <section id="section-courses">
      <div class="flex justify-between items-center mb-10">
        <div>
          <h2 class="text-2xl font-semibold text-slate-800 tracking-tight">èª²ç¨‹è¦æ ¼ç·¨ä¿®</h2>
          <p class="text-slate-400 text-sm mt-1">ç®¡ç†èˆ‡ç¶­è­·å…¨å³¶é‹å‹•èª²ç¨‹å®šç¾©</p>
        </div>
        <button onclick="openModal()" class="bg-emerald-500 text-white px-6 py-3 rounded-lg font-semibold shadow-lg shadow-emerald-200 hover:bg-emerald-600 transition-all active:scale-95 text-sm">
          + æ–°å¢èª²ç¨‹
        </button>
      </div>

      <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-slate-50 border-b border-slate-100 text-[11px] font-bold text-slate-500 uppercase tracking-wider">
              <th class="px-8 py-5">èª²ç¨‹ç·¨è™Ÿ / é¡åˆ¥</th>
              <th class="px-8 py-5">èª²ç¨‹åç¨± / è² è²¬æ•™ç·´</th>
              <th class="px-8 py-5">å ±åè²»ç”¨ (åŸåƒ¹/æ—©é³¥)</th>
              <th class="px-8 py-5">ç‹€æ…‹</th>
              <th class="px-8 py-5 text-right">ç®¡ç†</th>
            </tr>
          </thead>
          <tbody id="courseTableBody" class="divide-y divide-slate-50">
            <!-- èª²ç¨‹åˆ— -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- B. æ•¸æ“šæŸ¥è©¢ -->
    <section id="section-stats" class="hidden">
      <h2 class="text-2xl font-semibold text-slate-800 mb-8">å ±åç´€éŒ„æŸ¥è©¢</h2>
      <div class="bg-white border rounded-2xl p-20 text-center text-slate-300 font-medium italic">
        å ±è¡¨æ¨¡çµ„è®€å–ä¸­...
      </div>
    </section>

    <!-- C. ç³»çµ±è¨­å®š -->
    <section id="section-settings" class="hidden">
      <h2 class="text-2xl font-semibold text-slate-800 mb-10">ç³»çµ±åƒæ•¸è¨­å®š</h2>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
        <div class="bg-white p-10 rounded-2xl border border-slate-200 shadow-sm">
          <h3 class="font-bold text-slate-700 text-lg mb-6">è¨­å‚™ç§Ÿç”¨ç¯„æœ¬</h3>
          <div id="global-equip-list" class="space-y-4"></div>
          <button onclick="addGlobalEquip()" class="mt-6 text-xs font-semibold text-emerald-600 border-b border-emerald-200">+ æ–°å¢ç¯„æœ¬é …ç›®</button>
          <button onclick="saveGlobalSettings()" class="w-full mt-10 bg-slate-800 text-white py-4 rounded-xl font-bold uppercase tracking-widest hover:bg-slate-900 shadow-lg">åŒæ­¥å…¨åŸŸåƒæ•¸</button>
        </div>
        <div class="bg-white p-10 rounded-2xl border border-slate-200 shadow-sm">
          <h3 class="font-bold text-slate-700 text-lg mb-6">ä¸­å¿ƒé è¨­åŒ¯æ¬¾è³‡è¨Š</h3>
          <textarea id="global-payment" rows="6" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-medium text-base focus:bg-white transition-all outline-none" placeholder="è¼¸å…¥éŠ€è¡Œã€å¸³è™Ÿ..."></textarea>
        </div>
      </div>
    </section>

  </main>

  <!-- æ»‘å‡ºå¼ç·¨è¼¯å™¨ (é¿å…é®æ“‹) -->
  <div id="modalOverlay" onclick="closeModal()" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden z-[100]"></div>
  <div id="editModal" class="fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-2xl z-[101] slide-in flex flex-col">
    
    <div class="p-8 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0">
      <h3 id="modalTitle" class="text-xl font-semibold text-slate-800">ç·¨è¼¯èª²ç¨‹è¦æ ¼</h3>
      <button onclick="closeModal()" class="text-slate-400 hover:text-slate-800 text-3xl">&times;</button>
    </div>

    <form id="courseForm" class="flex-grow overflow-y-auto p-10 space-y-10">
      
      <!-- å€å¡Š 1: åŸºç¤ -->
      <div>
        <label class="label-text">Section 1: æ ¸å¿ƒè³‡æ–™è­˜åˆ¥</label>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div><span class="label-text">èª²ç¨‹ç·¨è™Ÿ</span><input type="text" id="f-id" required class="input-field font-mono font-bold text-emerald-600"></div>
          <div><span class="label-text">é¡åˆ¥</span><select id="f-category" class="input-field font-medium"><option value="å–®æ—¥">å–®æ—¥èª²ç¨‹</option><option value="æ¢¯æ¬¡">æ¢¯æ¬¡èª²ç¨‹</option><option value="ç‡ŸéšŠå°ˆå€">ç‡ŸéšŠå°ˆå€</option><option value="èª²å¾Œç­">èª²å¾Œç­</option></select></div>
          <div class="md:col-span-2"><span class="label-text">æ­£å¼åç¨±</span><input type="text" id="f-name" required class="input-field font-semibold"></div>
          <div><span class="label-text">æ¢¯æ¬¡ç­åˆ¥</span><input type="text" id="f-batch" class="input-field"></div>
          <div><span class="label-text">è² è²¬æ•™ç·´</span><input type="text" id="f-coach" class="input-field"></div>
        </div>
      </div>

      <hr class="border-slate-100">

      <!-- å€å¡Š 2: åƒ¹æ ¼æ™‚é–“ -->
      <div>
        <label class="label-text">Section 2: æ™‚é–“èˆ‡é‡‘é¡åƒæ•¸</label>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div><span class="label-text text-red-500">æ—©é³¥æˆªæ­¢æ—¥æœŸ</span><input type="date" id="f-earlyDeadline" class="input-field border-red-100"></div>
          <div><span class="label-text">åŸåƒ¹</span><input type="number" id="f-price" class="input-field font-bold"></div>
          <div><span class="label-text text-red-600">æ—©é³¥å„ªæƒ åƒ¹</span><input type="number" id="f-earlyPrice" class="input-field font-bold text-red-600 bg-red-50/30"></div>
          <div><span class="label-text text-blue-600">è«‹å‡æ¯å ‚æ‰£é™¤é¡</span><input type="number" id="f-leaveDeduct" class="input-field bg-blue-50/30"></div>
          <div><span class="label-text">é–‹å§‹æ™‚é–“</span><input type="text" id="f-start" placeholder="2026-07-01 09:00" class="input-field font-mono text-xs"></div>
          <div><span class="label-text">çµæŸæ™‚é–“</span><input type="text" id="f-end" placeholder="2026-07-05 17:00" class="input-field font-mono text-xs"></div>
        </div>
      </div>

      <hr class="border-slate-100">

      <!-- å€å¡Š 3: è¨­å‚™ -->
      <div>
        <div class="flex justify-between items-center mb-4">
          <label class="label-text mb-0">Section 3: èª²ç¨‹å°ˆå±¬è¨­å‚™ç§Ÿç”¨</label>
          <button type="button" onclick="addCourseEquip()" class="text-[10px] font-bold text-slate-400 border px-2 py-1 rounded hover:bg-slate-50">+ CUSTOM ITEM</button>
        </div>
        <div id="course-equip-list" class="space-y-3"></div>
      </div>

      <hr class="border-slate-100">

      <!-- å€å¡Š 4: èªªæ˜ -->
      <div>
        <label class="label-text">Section 4: æ–‡å­—èªªæ˜èˆ‡åª’é«”</label>
        <div class="space-y-6">
          <div><span class="label-text">åŒ¯æ¬¾è³‡è¨Š (ç•™ç©ºå‰‡å¸¶å…¥é è¨­)</span><textarea id="f-paymentInfo" rows="2" class="input-field"></textarea></div>
          <div><span class="label-text">è©³ç´°èª²ç¨‹èªªæ˜</span><textarea id="f-desc" rows="3" class="input-field"></textarea></div>
          <div class="grid grid-cols-2 gap-6">
            <div><span class="label-text">æ‹›ç”Ÿä¸Šé™</span><input type="number" id="f-limit" class="input-field"></div>
            <div><span class="label-text">å°é¢åœ–ç‰‡ç¶²å€</span><input type="text" id="f-img" class="input-field text-xs"></div>
          </div>
          <div><span class="label-text">ç›®å‰ç‹€æ…‹</span><select id="f-status" class="input-field font-bold text-emerald-600"><option value="å ±åä¸­">å ±åä¸­</option><option value="å·²é¡æ»¿">å·²é¡æ»¿</option><option value="åœè¾¦">åœè¾¦</option></select></div>
        </div>
      </div>

    </form>

    <div class="p-8 border-t border-slate-100 bg-slate-50 flex space-x-4">
      <button onclick="submitForm()" id="saveBtn" class="flex-grow bg-emerald-500 text-white py-4 rounded-xl font-semibold shadow-lg shadow-emerald-100 hover:bg-emerald-600 transition-all">å„²å­˜è¦æ ¼è³‡æ–™</button>
      <button onclick="closeModal()" class="px-8 bg-white text-slate-400 font-semibold border border-slate-200 rounded-xl hover:bg-slate-50">å–æ¶ˆ</button>
    </div>
  </div>

  <script>
    const API_URL = "https://sport.wetw-net3.workers.dev/";
    let courseList = [];
    let globalConfig = { è¨­å‚™ç¯„æœ¬: [], é è¨­åŒ¯æ¬¾: "" };

    async function init() {
      try {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'adminGetData' }) }).then(r => r.json());
        courseList = res.èª²ç¨‹ || [];
        globalConfig = res.è¨­å®š || { è¨­å‚™ç¯„æœ¬: [], é è¨­åŒ¯æ¬¾: "" };
        renderTable();
      } catch(e) { console.error(e); }
    }

    function renderTable() {
      document.getElementById('courseTableBody').innerHTML = courseList.map((c, i) => `
        <tr class="hover:bg-slate-50 transition-all group">
          <td class="px-8 py-6">
            <div class="font-mono text-sm text-slate-400 font-medium">${c.id}</div>
            <span class="badge cat-${c.category.substring(0,2)} mt-2 inline-block">${c.category}</span>
          </td>
          <td class="px-8 py-6">
            <div class="text-slate-800 font-semibold text-base">${c.name}</div>
            <div class="text-[11px] text-slate-400 mt-1 uppercase">${c.batch || '-'} | æ•™ç·´: ${c.coach}</div>
          </td>
          <td class="px-8 py-6">
            <div class="text-xs text-slate-300 line-through">$${c.price}</div>
            <div class="text-red-500 font-bold text-lg">$${c.earlyPrice}</div>
            <div class="text-[10px] text-slate-400 mt-1 uppercase font-medium">æˆªæ­¢: ${c.earlyBirdEnd}</div>
          </td>
          <td class="px-8 py-6">
            <span class="text-[11px] font-semibold ${c.status === 'å ±åä¸­' ? 'text-emerald-500' : 'text-slate-300'} uppercase border-b-2 ${c.status === 'å ±åä¸­' ? 'border-emerald-100' : 'border-slate-100'}">${c.status}</span>
          </td>
          <td class="px-8 py-6 text-right opacity-0 group-hover:opacity-100 transition-all">
            <button onclick="editCourse(${i})" class="text-blue-500 text-xs font-semibold mr-4 hover:underline">ç·¨è¼¯</button>
            <button onclick="cloneCourse(${i})" class="text-slate-400 text-xs font-semibold hover:underline">è¤‡è£½</button>
          </td>
        </tr>
      `).join('');
    }

    function switchTab(tab) {
      ['courses', 'stats', 'settings'].forEach(t => {
        document.getElementById('section-' + t).classList.toggle('hidden', t !== tab);
        document.getElementById('btn-' + t).classList.toggle('active', t === tab);
      });
      if(tab === 'settings') renderSettings();
    }

    function openModal() {
      document.getElementById('courseForm').reset();
      document.getElementById('f-id').disabled = false;
      document.getElementById('course-equip-list').innerHTML = "";
      globalConfig.è¨­å‚™ç¯„æœ¬.forEach(e => createEquipRow(document.getElementById('course-equip-list'), e.é …ç›®, e.é‡‘é¡, "f-equip-item"));
      document.getElementById('modalOverlay').classList.remove('hidden');
      document.getElementById('editModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.add('hidden');
      document.getElementById('editModal').classList.remove('active');
    }

    function editCourse(idx) {
      const c = courseList[idx];
      fillForm(c);
      document.getElementById('f-id').disabled = true;
      document.getElementById('modalOverlay').classList.remove('hidden');
      document.getElementById('editModal').classList.add('active');
    }

    function cloneCourse(idx) {
      fillForm(courseList[idx]);
      document.getElementById('f-id').value = courseList[idx].id + "-COPY";
      document.getElementById('f-id').disabled = false;
      document.getElementById('modalOverlay').classList.remove('hidden');
      document.getElementById('editModal').classList.add('active');
    }

    function fillForm(c) {
      document.getElementById('f-id').value = c.id;
      document.getElementById('f-category').value = c.category;
      document.getElementById('f-name').value = c.name;
      document.getElementById('f-batch').value = c.batch;
      document.getElementById('f-coach').value = c.coach;
      document.getElementById('f-start').value = c.start;
      document.getElementById('f-end').value = c.end;
      document.getElementById('f-price').value = c.price;
      document.getElementById('f-earlyPrice').value = c.earlyPrice;
      document.getElementById('f-earlyDeadline').value = c.earlyBirdEnd;
      document.getElementById('f-leaveDeduct').value = c.leaveDeduct;
      document.getElementById('f-paymentInfo').value = c.paymentInfo;
      document.getElementById('f-desc').value = c.desc;
      document.getElementById('f-img').value = c.img;
      document.getElementById('f-limit').value = c.limit;
      document.getElementById('f-status').value = c.status;
      const list = document.getElementById('course-equip-list');
      list.innerHTML = "";
      try { JSON.parse(c.equips || "[]").forEach(e => createEquipRow(list, e.é …ç›®, e.é‡‘é¡, "f-equip-item")); } catch(err) {}
    }

    function createEquipRow(container, name = "", price = "", className = "") {
      const div = document.createElement('div');
      div.className = `flex items-center space-x-3 ${className}`;
      div.innerHTML = `
        <input type="text" placeholder="é …ç›®" value="${name}" class="flex-grow p-3 bg-white border border-slate-200 rounded-lg text-sm outline-none">
        <input type="number" placeholder="é‡‘é¡" value="${price}" class="w-24 p-3 bg-white border border-slate-200 rounded-lg text-sm font-bold text-emerald-600 outline-none">
        <button type="button" onclick="this.parentElement.remove()" class="text-slate-300 hover:text-red-400 text-xl font-bold px-2">&times;</button>
      `;
      container.appendChild(div);
    }

    function addCourseEquip() { createEquipRow(document.getElementById('course-equip-list'), "", 0, "f-equip-item"); }
    function addGlobalEquip() { createEquipRow(document.getElementById('global-equip-list'), "", 0, "g-equip-item"); }

    async function submitForm() {
      const btn = document.getElementById('saveBtn');
      btn.disabled = true; btn.innerText = "è³‡æ–™åŒæ­¥ä¸­...";
      const equips = [];
      document.querySelectorAll('.f-equip-item').forEach(el => {
        const ins = el.querySelectorAll('input');
        if(ins[0].value) equips.push({é …ç›®: ins[0].value, é‡‘é¡: Number(ins[1].value)});
      });
      const data = {
        action: 'adminSaveCourse', id: document.getElementById('f-id').value, category: document.getElementById('f-category').value,
        name: document.getElementById('f-name').value, batch: document.getElementById('f-batch').value, coach: document.getElementById('f-coach').value,
        start: document.getElementById('f-start').value, end: document.getElementById('f-end').value, price: Number(document.getElementById('f-price').value),
        earlyPrice: Number(document.getElementById('f-earlyPrice').value), earlyBirdEnd: document.getElementById('f-earlyDeadline').value,
        limit: Number(document.getElementById('f-limit').value), status: document.getElementById('f-status').value, img: document.getElementById('f-img').value,
        desc: document.getElementById('f-desc').value, leaveDeduct: Number(document.getElementById('f-leaveDeduct').value), equips: JSON.stringify(equips), paymentInfo: document.getElementById('f-paymentInfo').value
      };
      await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
      alert("å„²å­˜æˆåŠŸ"); init(); closeModal();
      btn.disabled = false; btn.innerText = "å„²å­˜è¦æ ¼è³‡æ–™";
    }

    function renderSettings() {
      document.getElementById('global-payment').value = globalConfig.é è¨­åŒ¯æ¬¾;
      const list = document.getElementById('global-equip-list');
      list.innerHTML = "";
      globalConfig.è¨­å‚™ç¯„æœ¬.forEach(e => createEquipRow(list, e.é …ç›®, e.é‡‘é¡, "g-equip-item"));
    }

    async function saveGlobalSettings() {
      const template = [];
      document.querySelectorAll('.g-equip-item').forEach(el => {
        const ins = el.querySelectorAll('input');
        if(ins[0].value) template.push({é …ç›®: ins[0].value, é‡‘é¡: Number(ins[1].value)});
      });
      const data = { action: 'adminSaveSettings', è¨­å‚™ç¯„æœ¬: JSON.stringify(template), é è¨­åŒ¯æ¬¾: document.getElementById('global-payment').value };
      await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
      alert("å…¨åŸŸè¨­å®šå·²æ›´æ–°"); init();
    }

    window.onload = init;
  </script>
</body>
</html>
