<!-- æª”æ¡ˆåç¨±ï¼šadmin.html (ç®¡ç†å¾Œå° - V6.5.3 ç©©å®šæäº¤ç‰ˆ) -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>é‹å‹•å³¶ç®¡ç†ç³»çµ± - ç®¡ç†ä¸­å¿ƒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
    
    /* æ ¸å¿ƒè¨­è¨ˆï¼šç„¡ç°éšã€ç´”è‰²å°æ¯”ã€å¤§å­—é«” */
    body { background-color: #ffffff; font-family: 'Noto Sans TC', sans-serif; color: #000000; font-size: 16px; margin: 0; }
    
    .sidebar { background-color: #000000; width: 260px; }
    .sidebar-item { color: #ffffff; padding: 20px 24px; display: block; border-bottom: 2px solid #111; width: 100%; text-align: left; }
    .sidebar-item:hover { background-color: #004dc0; }
    .sidebar-item.active { background-color: #004dc0; border-right: 10px solid #52c41a; font-weight: 900; }
    
    .tag { padding: 6px 12px; border: 2px solid #000; color: #ffffff; font-weight: 900; font-size: 13px; text-transform: uppercase; }
    .tag-å–®æ—¥ { background-color: #003a8c; }
    .tag-æ¢¯æ¬¡ { background-color: #135200; }
    .tag-ç‡ŸéšŠ { background-color: #873800; }

    /* å…¨è¢å¹•æ²ˆæµ¸å¼ç·¨è¼¯å™¨ */
    #full-editor { display: none; position: fixed; inset: 0; background: #ffffff; z-index: 1000; overflow-y: auto; }
    #full-editor.active { display: block; }
    
    .form-card { border: 4px solid #000000; padding: 40px; margin-bottom: 40px; background: #ffffff; }
    .form-label { font-size: 16px; font-weight: 900; color: #000000; margin-bottom: 12px; display: block; text-transform: uppercase; }
    .form-input { 
      width: 100%; padding: 16px; border: 3px solid #000000; border-radius: 0; 
      font-size: 18px; color: #000000; background: #ffffff; outline: none; 
    }
    .form-input:focus { border-color: #004dc0; background-color: #f0f7ff; }
    .form-input[readonly] { background-color: #eeeeee; border-color: #555555; cursor: not-allowed; }

    /* è¡¨æ ¼ */
    table { width: 100%; border-collapse: collapse; border: 4px solid #000; }
    table th { background-color: #000000; color: #ffffff; padding: 20px; text-align: left; font-weight: 900; font-size: 14px; }
    table td { border: 2px solid #000000; padding: 24px; vertical-align: middle; }
    
    .price-heavy { color: #cf1322; font-weight: 900; font-size: 24px; font-family: monospace; }
    
    /* è¨Šæ¯é®ç½© */
    #loading-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); color: white; display: none; flex-direction: column; items-center justify-center; z-index: 3000; }
    .spinner { border: 8px solid #f3f3f3; border-top: 8px solid #3498db; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin-bottom: 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="flex min-h-screen">

  <div id="loading-overlay">
    <div class="spinner"></div>
    <p class="text-2xl font-black tracking-widest">æ­£åœ¨åŒæ­¥è³‡æ–™è‡³é›²ç«¯ï¼Œè«‹å‹¿é—œé–‰è¦–çª—...</p>
  </div>

  <aside class="sidebar flex flex-col fixed inset-y-0 left-0 z-50 shadow-2xl">
    <div class="p-8 border-b-4 border-gray-800 bg-black text-center">
      <h1 class="text-white font-black text-3xl tracking-tighter italic">SI ADMIN</h1>
      <p class="text-green-500 text-xs mt-2 font-black uppercase tracking-widest">2026 Management</p>
    </div>
    <nav class="flex-grow">
      <button onclick="switchTab('courses')" id="btn-courses" class="sidebar-item active">ğŸ“š èª²ç¨‹è¦æ ¼ç®¡ç†</button>
      <button onclick="switchTab('settings')" id="btn-settings" class="sidebar-item">âš™ï¸ å…¨å±€åƒæ•¸è¨­å®š</button>
    </nav>
  </aside>

  <main class="flex-grow ml-[260px] p-12">
    <section id="section-courses">
      <div class="flex justify-between items-center mb-12">
        <div>
          <h2 class="text-5xl font-black text-black uppercase tracking-tighter">Courses</h2>
          <p class="text-blue-700 font-black mt-2 text-lg">ç‡Ÿé‹è¦æ ¼ç®¡ç†ä¸­å¿ƒ</p>
        </div>
        <button onclick="openNewCourse()" class="bg-blue-700 text-white px-16 py-6 font-black shadow-2xl hover:bg-black transition-all text-2xl">
          + æ–°å¢èª²ç¨‹è¦æ ¼
        </button>
      </div>

      <div class="bg-white">
        <table>
          <thead>
            <tr>
              <th class="w-40">ç·¨è™Ÿ / é¡åˆ¥</th>
              <th>æ­£å¼åç¨± / è² è²¬æ•™ç·´</th>
              <th class="w-56">å–®åƒ¹ / ç¸½é¡</th>
              <th class="w-64">ç‡Ÿé‹æœŸé–“</th>
              <th class="text-right w-40">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="courseTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- ç³»çµ±è¨­å®šå€ -->
    <section id="section-settings" class="hidden">
      <h2 class="text-4xl font-black text-black mb-12 uppercase italic">Settings</h2>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <div class="bg-white p-12 border-[6px] border-black">
          <div class="flex justify-between items-center mb-10 border-b-4 border-black pb-4">
            <h3 class="font-black text-3xl text-blue-800 uppercase">è¨­å‚™ç§Ÿç”¨ç¯„æœ¬</h3>
            <button onclick="addGlobalEquip()" class="bg-green-700 text-white px-6 py-2 font-black">+ æ–°å¢</button>
          </div>
          <div id="global-equip-list" class="space-y-4"></div>
          <button onclick="saveGlobalSettings()" class="w-full mt-12 bg-black text-white py-6 font-black uppercase text-2xl">åŒæ­¥å…¨åŸŸåƒæ•¸</button>
        </div>
        <div class="bg-white p-12 border-[6px] border-black">
          <h3 class="font-black text-3xl text-blue-800 uppercase mb-10 border-b-4 border-black pb-4">é è¨­åŒ¯æ¬¾å¸³è™Ÿ</h3>
          <textarea id="global-payment" rows="10" class="form-input font-black text-2xl leading-relaxed"></textarea>
        </div>
      </div>
    </section>
  </main>

  <!-- å…¨è¢å¹•æ²‰æµ¸å¼ç·¨è¼¯å™¨ -->
  <div id="full-editor">
    <div class="max-w-7xl mx-auto py-20 px-10">
      <div class="flex justify-between items-center mb-16 border-b-[12px] border-black pb-10">
        <div>
          <h2 id="editorTitle" class="text-7xl font-black text-black uppercase italic tracking-tighter">Edit Specification</h2>
          <p class="text-blue-800 font-black mt-4 text-2xl tracking-widest">V6.5.3 ç‰ˆ | å®Œå…¨è§£è€¦æ¶æ§‹</p>
        </div>
        <button onclick="closeEditor()" class="bg-red-700 text-white px-16 py-6 font-black text-3xl shadow-2xl hover:bg-black">æ”¾æ£„ç·¨è¼¯</button>
      </div>

      <div class="space-y-16 pb-96">
        <!-- 01 èº«åˆ† -->
        <div class="form-card">
          <h3 class="text-4xl font-black mb-12 border-l-[16px] border-blue-700 pl-8 uppercase">01 æ ¸å¿ƒè­˜åˆ¥è³‡æ–™</h3>
          <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
            <div><label class="form-label">èª²ç¨‹ ID (è‡ªå‹•)</label><input type="text" id="f-id" readonly class="form-input font-mono font-black text-blue-800"></div>
            <div><label class="form-label">é¡åˆ¥</label><select id="f-category" class="form-input font-black"><option value="æ¢¯æ¬¡">æ¢¯æ¬¡èª²ç¨‹</option><option value="å–®æ—¥">å–®æ—¥èª²ç¨‹</option><option value="ç‡ŸéšŠ">ç‡ŸéšŠå°ˆå€</option><option value="èª²å¾Œ">èª²å¾Œç­</option></select></div>
            <div class="md:col-span-2"><label class="form-label">æ­£å¼åç¨± (æ¨¡æ¿åç¨±)</label><input type="text" id="f-name" class="form-input font-black text-2xl"></div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mt-12">
            <div><label class="form-label">æ¢¯æ¬¡ç­åˆ¥ä»£è™Ÿ (ä¾‹å¦‚ï¼š2026 å¤å­£ A æ¢¯)</label><input type="text" id="f-batch" class="form-input font-black text-xl"></div>
            <div><label class="form-label">ä¸»è²¬æ•™ç·´</label><input type="text" id="f-coach" class="form-input font-black text-xl"></div>
          </div>
        </div>

        <!-- 02 è¨ˆè²» -->
        <div class="form-card">
          <h3 class="text-4xl font-black mb-12 border-l-[16px] border-blue-700 pl-8 uppercase">02 è²¡å‹™è¨ˆè²»èˆ‡æ—¥æœŸ</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-10">
            <div><label class="form-label text-red-700">æ¯æ—¥å‡ºå¸­å–®åƒ¹</label><input type="number" id="f-baseUnit" class="form-input font-black text-red-700 text-3xl"></div>
            <div><label class="form-label">å…¨æ¢¯æ¬¡å®Œæ•´ç¸½åƒ¹</label><input type="number" id="f-fullPrice" class="form-input font-black text-black text-3xl"></div>
            <div><label class="form-label">é–‹å§‹æ—¥æœŸ</label><input type="date" id="f-start" class="form-input font-black"></div>
            <div><label class="form-label">çµæŸæ—¥æœŸ</label><input type="date" id="f-end" class="form-input font-black"></div>
          </div>
          <div class="mt-12 p-12 bg-rose-50 border-[6px] border-rose-600 grid grid-cols-1 md:grid-cols-2 gap-12">
             <div><label class="form-label text-rose-800 font-black text-xl">æ—©é³¥æˆªæ­¢æ—¥æœŸ</label><input type="date" id="f-earlyDeadline" class="form-input border-rose-800 text-xl"></div>
             <div><label class="form-label text-rose-800 font-black text-xl">æ—©é³¥å…¨é¡å„ªæƒ ç¸½åƒ¹</label><input type="number" id="f-earlyPrice" class="form-input border-rose-800 font-black text-rose-800 text-3xl"></div>
          </div>
        </div>

        <!-- 03 è¨­å‚™ -->
        <div class="form-card">
          <div class="flex justify-between items-center mb-12 border-b-8 border-black pb-4">
            <h3 class="text-4xl font-black border-l-[16px] border-blue-700 pl-8 uppercase">03 è¨­å‚™åŠ è³¼æ¸…å–®</h3>
            <button type="button" onclick="addCourseEquip()" class="bg-black text-white px-10 py-4 font-black text-xl">+ å¢åŠ è‡ªå®šç¾©é …ç›®</button>
          </div>
          <div id="course-equip-list" class="space-y-8"></div>
        </div>

        <!-- 04 ç‹€æ…‹ -->
        <div class="form-card">
          <h3 class="text-4xl font-black mb-12 border-l-[16px] border-blue-700 pl-8 uppercase">04 ç™¼å¸ƒèˆ‡èªªæ˜</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-16">
            <div><label class="form-label">åŒ¯æ¬¾è³‡è¨Š (ç•™ç©ºå¥—ç”¨é è¨­)</label><textarea id="f-paymentInfo" rows="5" class="form-input font-black text-xl"></textarea></div>
            <div><label class="form-label">è©³ç´°èªªæ˜ / æ”œå¸¶ç‰©å“</label><textarea id="f-desc" rows="5" class="form-input font-black text-xl"></textarea></div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mt-12">
            <div><label class="form-label">å°é¢åœ–ç‰‡ HTTPS ç¶²å€</label><input type="text" id="f-img" class="form-input font-mono text-base"></div>
            <div class="grid grid-cols-2 gap-10">
              <div><label class="form-label">äººæ•¸ä¸Šé™</label><input type="number" id="f-limit" class="form-input font-black text-3xl"></div>
              <div><label class="form-label">ç›®å‰ç™¼å¸ƒç‹€æ…‹</label><select id="f-status" class="form-input font-black text-green-800 text-3xl border-green-700"><option value="å ±åä¸­">å ±åä¸­</option><option value="å·²é¡æ»¿">å·²é¡æ»¿</option><option value="åœè¾¦">åœè¾¦</option></select></div>
            </div>
          </div>
        </div>

        <!-- å„²å­˜æŒ‰éˆ•ï¼šå›ºå®šåœ¨è¦–çª—åº•éƒ¨ -->
        <div class="fixed bottom-0 left-[260px] right-0 p-12 bg-white border-t-[12px] border-black shadow-2xl flex justify-center z-[1100]">
          <button type="button" onclick="submitCourseForm()" class="bg-blue-700 text-white px-80 py-10 font-black text-5xl uppercase tracking-[0.5em] hover:bg-black transition-all active:scale-95">å„²å­˜ä¸¦åŒæ­¥é›²ç«¯</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = window.location.href.split('?')[0];
    let courseList = [];
    let globalConfig = { è¨­å‚™ç¯„æœ¬: [], é è¨­åŒ¯æ¬¾: "" };

    async function init() {
      try {
        const res = await fetch(API_URL, { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'adminGetData' }) 
        });
        const data = await res.json();
        courseList = data.èª²ç¨‹ || [];
        globalConfig = data.è¨­å®š || { è¨­å‚™ç¯„æœ¬: [], é è¨­åŒ¯æ¬¾: "" };
        renderTable();
      } catch(e) { alert("è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Worker è¨­å®šã€‚"); }
    }

    function renderTable() {
      document.getElementById('courseTableBody').innerHTML = courseList.map((c, i) => `
        <tr class="hover:bg-blue-50 transition-all font-black">
          <td><div class="font-mono text-blue-800 text-lg mb-2">${c.id}</div><span class="tag tag-${c.category.substring(0,2)}">${c.category}</span></td>
          <td><div class="text-3xl text-black">${c.name}</div><div class="text-lg text-blue-700 uppercase mt-2">${c.batch || '-'} | æ•™ç·´: ${c.coach}</div></td>
          <td><div class="price-heavy">$${c.baseUnit}</div><div class="text-sm text-black font-black uppercase mt-1">Full: $${c.fullPrice}</div></td>
          <td class="text-base text-black font-mono tracking-tighter">${c.start} ~ ${c.end}</td>
          <td class="text-right">
            <button onclick="editCourse(${i})" class="bg-blue-700 text-white px-8 py-3 font-black mb-3 block w-full text-xl shadow-lg">ç·¨è¼¯</button>
            <button onclick="cloneCourse(${i})" class="bg-black text-white px-8 py-3 font-black block w-full text-xl shadow-lg">è¤‡è£½</button>
          </td>
        </tr>`).join('');
    }

    function openNewCourse() {
      document.getElementById('f-id').value = "C" + Math.floor(Date.now() / 1000);
      document.getElementById('f-category').value = "æ¢¯æ¬¡";
      document.getElementById('f-name').value = "";
      document.getElementById('f-batch').value = "";
      document.getElementById('f-coach').value = "";
      document.getElementById('f-baseUnit').value = 0;
      document.getElementById('f-fullPrice').value = 0;
      document.getElementById('f-earlyPrice').value = 0;
      document.getElementById('course-equip-list').innerHTML = "";
      globalConfig.è¨­å‚™ç¯„æœ¬.forEach(e => createEquipRow(document.getElementById('course-equip-list'), e.é …ç›®, e.é‡‘é¡, e.è¨ˆè²»é¡å‹, "f-equip-item"));
      document.getElementById('full-editor').classList.add('active');
    }

    function editCourse(idx) { fillForm(courseList[idx]); document.getElementById('full-editor').classList.add('active'); }
    function cloneCourse(idx) { fillForm(courseList[idx]); document.getElementById('f-id').value = "C" + Math.floor(Date.now() / 1000); document.getElementById('full-editor').classList.add('active'); }

    function fillForm(c) {
      document.getElementById('f-id').value = c.id; document.getElementById('f-category').value = c.category;
      document.getElementById('f-name').value = c.name; document.getElementById('f-batch').value = c.batch;
      document.getElementById('f-coach').value = c.coach; document.getElementById('f-start').value = c.start;
      document.getElementById('f-end').value = c.end; document.getElementById('f-baseUnit').value = c.baseUnit;
      document.getElementById('f-fullPrice').value = c.fullPrice; document.getElementById('f-earlyDeadline').value = c.earlyBirdEnd;
      document.getElementById('f-earlyPrice').value = c.earlyPrice || 0; document.getElementById('f-paymentInfo').value = c.paymentInfo;
      document.getElementById('f-desc').value = c.desc; document.getElementById('f-img').value = c.img;
      document.getElementById('f-limit').value = c.limit; document.getElementById('f-status').value = c.status;
      const list = document.getElementById('course-equip-list'); list.innerHTML = "";
      try { JSON.parse(c.equips || "[]").forEach(e => createEquipRow(list, e.é …ç›®, e.é‡‘é¡, e.è¨ˆè²»é¡å‹, "f-equip-item")); } catch(err) {}
    }

    function createEquipRow(container, name = "", price = "", type = "æŒ‰å¤©è¨ˆè²»", className = "") {
      const div = document.createElement('div');
      div.className = `flex items-center space-x-8 p-8 border-[6px] border-slate-100 ${className}`;
      div.innerHTML = `<input type="text" placeholder="é …ç›®" value="${name}" class="flex-grow form-input font-black"><input type="number" placeholder="å–®åƒ¹" value="${price}" class="w-48 form-input font-black text-red-700 text-2xl"><select class="w-64 form-input font-black text-blue-800"><option value="æŒ‰å¤©è¨ˆè²»" ${type==='æŒ‰å¤©è¨ˆè²»'?'selected':''}>æŒ‰å¤©è¨ˆè²»</option><option value="å–®æ¬¡å›ºå®š" ${type==='å–®æ¬¡å›ºå®š'?'selected':''}>å–®æ¬¡å›ºå®š</option></select><button type="button" onclick="this.parentElement.remove()" class="bg-red-700 text-white px-10 py-3 font-black text-xl shadow-xl">ç§»é™¤</button>`;
      container.appendChild(div);
    }

    // é—œéµä¿®æ­£ï¼šæ”¹ç”¨æ‰‹å‹•å‡½æ•¸ï¼Œå¾¹åº•æ’é™¤è¡¨å–®è·³è½‰
    async function submitCourseForm() {
      const overlay = document.getElementById('loading-overlay');
      overlay.style.display = 'flex';

      const equips = [];
      document.querySelectorAll('.f-equip-item').forEach(el => {
        const ins = el.querySelectorAll('input'); const sel = el.querySelector('select');
        if(ins[0].value) equips.push({é …ç›®: ins[0].value, é‡‘é¡: Number(ins[1].value), è¨ˆè²»é¡å‹: sel.value});
      });

      const data = { 
        action: 'adminSaveCourse', id: document.getElementById('f-id').value, 
        category: document.getElementById('f-category').value, name: document.getElementById('f-name').value, 
        batch: document.getElementById('f-batch').value, coach: document.getElementById('f-coach').value, 
        start: document.getElementById('f-start').value, end: document.getElementById('f-end').value, 
        baseUnit: Number(document.getElementById('f-baseUnit').value), fullPrice: Number(document.getElementById('f-fullPrice').value), 
        earlyBirdEnd: document.getElementById('f-earlyDeadline').value, earlyPrice: Number(document.getElementById('f-earlyPrice').value), 
        limit: Number(document.getElementById('f-limit').value), status: document.getElementById('f-status').value, 
        img: document.getElementById('f-img').value, desc: document.getElementById('f-desc').value, 
        equips: JSON.stringify(equips), paymentInfo: document.getElementById('f-paymentInfo').value 
      };

      try {
        const res = await fetch(API_URL, { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data) 
        });
        const result = await res.json();
        if(result.success) {
          alert("é›²ç«¯åŒæ­¥æˆåŠŸï¼");
          await init();
          closeEditor();
        } else {
          throw new Error(result.msg);
        }
      } catch(err) {
        alert("å„²å­˜å¤±æ•—ï¼š" + err.message);
      } finally {
        overlay.style.display = 'none';
      }
    }

    function switchTab(tab) {
      document.getElementById('section-courses').classList.toggle('hidden', tab !== 'courses');
      document.getElementById('section-settings').classList.toggle('hidden', tab !== 'settings');
      document.getElementById('btn-courses').classList.toggle('active', tab === 'courses');
      document.getElementById('btn-settings').classList.toggle('active', tab === 'settings');
      if(tab === 'settings') renderSettings();
    }
    function renderSettings() {
      document.getElementById('global-payment').value = globalConfig.é è¨­åŒ¯æ¬¾ || "";
      const list = document.getElementById('global-equip-list'); list.innerHTML = "";
      globalConfig.è¨­å‚™ç¯„æœ¬.forEach(e => createEquipRow(list, e.é …ç›®, e.é‡‘é¡, e.è¨ˆè²»é¡å‹, "g-equip-item"));
    }
    async function saveGlobalSettings() {
      document.getElementById('loading-overlay').style.display = 'flex';
      const template = [];
      document.querySelectorAll('.g-equip-item').forEach(el => {
        const ins = el.querySelectorAll('input'); const sel = el.querySelector('select');
        if(ins[0].value) template.push({é …ç›®: ins[0].value, é‡‘é¡: Number(ins[1].value), è¨ˆè²»é¡å‹: sel.value});
      });
      try {
        await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'adminSaveSettings', è¨­å‚™ç¯„æœ¬: JSON.stringify(template), é è¨­åŒ¯æ¬¾: document.getElementById('global-payment').value }) });
        alert("è¨­å®šæ›´æ–°æˆåŠŸã€‚"); init();
      } catch(e) { alert("åŒæ­¥å¤±æ•—"); }
      finally { document.getElementById('loading-overlay').style.display = 'none'; }
    }
    function closeEditor() { document.getElementById('full-editor').classList.remove('active'); }
    function addGlobalEquip() { createEquipRow(document.getElementById('global-equip-list'), "æ–°è¨­å‚™é …ç›®", 0, "æŒ‰å¤©è¨ˆè²»", "g-equip-item"); }
    function addCourseEquip() { createEquipRow(document.getElementById('course-equip-list'), "", 0, "æŒ‰å¤©è¨ˆè²»", "f-equip-item"); }
    window.onload = init;
  </script>
</body>
</html>
