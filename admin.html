<!--
=====================================================
æª”æ¡ˆåç¨±ï¼šadmin.html
ç‰ˆæœ¬ï¼šV6.8.0ï¼ˆå®Œæ•´è¦†è“‹ç‰ˆï¼‰
è§’è‰²ï¼šèª²ç¨‹ã€Œè¦æ ¼ã€ç®¡ç†ï¼ˆéèª²è¡¨ï¼‰
=====================================================
-->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>é‹å‹•å³¶ç®¡ç†ä¸­å¿ƒï½œAdmin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: #F4F5F7;
      font-size: 15px;
    }
    :root {
      --line: #06C755;
      --border: #E7E9ED;
    }
    .sidebar { width: 220px; background: #fff; border-right: 1px solid var(--border); height: 100vh; position: fixed; }
    .sidebar-item { padding: 16px 24px; font-weight: 600; cursor: pointer; }
    .sidebar-item.active {
      background: #F0FBF5;
      color: var(--line);
      border-right: 4px solid var(--line);
    }
    .btn { padding: 10px 20px; border-radius: 6px; font-weight: 700; }
    .btn-primary { background: var(--line); color: #fff; }
    .btn-outline { border: 1px solid var(--line); color: var(--line); }
  </style>
</head>

<body class="flex">

<!-- Loading -->
<div id="loading" class="fixed inset-0 bg-white/80 hidden z-50 flex items-center justify-center">
  <div class="animate-spin h-10 w-10 border-4 border-green-500 border-t-transparent rounded-full"></div>
</div>

<!-- Sidebar -->
<aside class="sidebar">
  <div class="p-6 font-black text-xl text-green-600 border-b">SI MANAGER</div>
  <button class="sidebar-item active">èª²ç¨‹è¦æ ¼ç®¡ç†</button>
</aside>

<!-- Main -->
<main class="ml-[220px] p-10 w-full">

  <div class="flex justify-between mb-8">
    <div>
      <h1 class="text-3xl font-black">èª²ç¨‹è¦æ ¼æ¸…å–®</h1>
      <p class="text-slate-400 mt-1">åƒ…å®šç¾©ã€Œåƒ¹æ ¼ã€èªªæ˜ã€æ•™ç·´ã€åˆ†é¡ã€ï¼Œä¸ä»£è¡¨å¯¦éš›ä¸Šèª²æ™‚é–“</p>
    </div>
    <button onclick="openNew()" class="btn btn-primary">ï¼‹ æ–°å¢è¦æ ¼</button>
  </div>

  <table class="w-full bg-white border rounded-xl overflow-hidden">
    <thead class="bg-slate-50 text-slate-500 text-sm">
      <tr>
        <th class="p-4 text-left w-32">ID</th>
        <th class="p-4 text-left w-24">é¡åˆ¥</th>
        <th class="p-4 text-left">è¦æ ¼èªªæ˜</th>
        <th class="p-4 text-left w-48">å®šåƒ¹</th>
        <th class="p-4 text-right w-32">æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="list">
      <tr><td colspan="5" class="p-10 text-center text-slate-300">è®€å–ä¸­â€¦</td></tr>
    </tbody>
  </table>
</main>

<!-- Editor -->
<div id="editor" class="fixed inset-0 bg-white hidden z-40 overflow-y-auto">
  <div class="sticky top-0 bg-white border-b p-4 flex justify-between">
    <div>
      <div class="font-black text-lg">ç·¨è¼¯èª²ç¨‹è¦æ ¼</div>
      <div class="text-xs text-slate-400">æ­¤è™•ä¸è¨­å®šä¸Šèª²æ™‚é–“</div>
    </div>
    <div>
      <button onclick="closeEditor()" class="btn btn-outline mr-2">å–æ¶ˆ</button>
      <button onclick="save()" class="btn btn-primary">å„²å­˜</button>
    </div>
  </div>

  <div class="max-w-4xl mx-auto p-10 space-y-8">
    <input type="hidden" id="id">

    <div>
      <label class="font-bold">é¡åˆ¥</label>
      <select id="category" class="w-full p-3 border rounded mt-2">
        <option value="å–®æ—¥">å–®æ—¥</option>
        <option value="ç‡ŸéšŠ">ç‡ŸéšŠ</option>
        <option value="èª²å¾Œ">èª²å¾Œ</option>
      </select>
    </div>

    <div>
      <label class="font-bold">è¦æ ¼åç¨±</label>
      <input id="name" class="w-full p-3 border rounded mt-2">
    </div>

    <div class="grid grid-cols-4 gap-4">
      <input id="fullPrice" type="number" placeholder="å®šåƒ¹" class="p-3 border rounded">
      <input id="discountPrice" type="number" placeholder="å„ªæƒ åƒ¹" class="p-3 border rounded">
      <input id="earlyPrice" type="number" placeholder="æ—©é³¥åƒ¹" class="p-3 border rounded">
      <input id="baseUnit" type="number" placeholder="è«‹å‡æ‰£é™¤ / æ—¥" class="p-3 border rounded">
    </div>

    <div>
      <label class="font-bold">è©³ç´°èªªæ˜</label>
      <textarea id="desc" rows="5" class="w-full p-3 border rounded mt-2"></textarea>
    </div>
  </div>
</div>

<script>
  const API = location.href; // ğŸ”¥ åŒæº GAS WebApp
  let list = [];

  function showLoading(v){ document.getElementById('loading').style.display = v?'flex':'none'; }

  async function init(){
    showLoading(true);
    const res = await fetch(API,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:'adminGetData'})
    }).then(r=>r.json());
    list = res.èª²ç¨‹ || [];
    render();
    showLoading(false);
  }

  function render(){
    const el = document.getElementById('list');
    if(list.length===0){
      el.innerHTML='<tr><td colspan="5" class="p-10 text-center text-slate-300">å°šç„¡è³‡æ–™</td></tr>';
      return;
    }
    el.innerHTML = list.map((c,i)=>`
      <tr class="border-t">
        <td class="p-4 text-xs text-slate-400">${c.id}</td>
        <td class="p-4">${c.category}</td>
        <td class="p-4 font-bold">${c.name}</td>
        <td class="p-4">$${(c.fullPrice||0).toLocaleString()}</td>
        <td class="p-4 text-right">
          <button onclick="edit(${i})" class="btn btn-outline text-sm">ç·¨è¼¯</button>
        </td>
      </tr>`).join('');
  }

  function edit(i){
    const c=list[i];
    id.value=c.id;
    category.value=c.category;
    name.value=c.name;
    fullPrice.value=c.fullPrice||0;
    discountPrice.value=c.discountPrice||0;
    earlyPrice.value=c.earlyPrice||0;
    baseUnit.value=c.baseUnit||0;
    desc.value=c.desc||'';
    editor.style.display='block';
  }

  function openNew(){
    id.value='C'+Date.now();
    editor.style.display='block';
  }

  function closeEditor(){ editor.style.display='none'; }

  async function save(){
    showLoading(true);
    const payload={
      action:'adminSaveCourse',
      id:id.value,
      category:category.value,
      name:name.value,
      fullPrice:Number(fullPrice.value)||0,
      discountPrice:Number(discountPrice.value)||0,
      earlyPrice:Number(earlyPrice.value)||0,
      baseUnit:Number(baseUnit.value)||0,
      desc:desc.value,
      status:'å ±åä¸­'
    };
    await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    closeEditor();
    init();
  }

  window.onload=init;
</script>

</body>
</html>
