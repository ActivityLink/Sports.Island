<!-- æª”æ¡ˆåç¨±ï¼šadmin.html (ç®¡ç†å¾Œå° - å¤šæ—¥è¨ˆè²»æ”¯æ´ç‰ˆ) -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>é‹å‹•å³¶ - å³¶å…§ç®¡ç†ä¸­å¿ƒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
    body { background-color: #f8fafc; font-family: 'Inter', sans-serif; color: #1e293b; }
    .sidebar { background-color: #1e293b; width: 260px; }
    .sidebar-item { color: #94a3b8; transition: all 0.2s; border-left: 4px solid transparent; }
    .sidebar-item.active { background-color: #0f172a; color: #ffffff; border-left: 4px solid #10b981; }
    .slide-in { transform: translateX(100%); transition: transform 0.3s ease-out; }
    .slide-in.active { transform: translateX(0); }
    .input-field { width: 100%; padding: 10px 14px; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; outline: none; }
    .input-field:focus { border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.05); }
    .label-text { font-size: 11px; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block; }
    .badge { padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; }
    .cat-å–®æ—¥ { background-color: #eff6ff; color: #3b82f6; }
    .cat-æ¢¯æ¬¡ { background-color: #ecfdf5; color: #10b981; }
  </style>
</head>
<body class="flex min-h-screen">

  <aside class="sidebar flex flex-col fixed inset-y-0 left-0 z-50 shadow-xl">
    <div class="p-8 border-b border-slate-700 flex items-center space-x-3">
      <div class="w-8 h-8 bg-emerald-500 rounded flex items-center justify-center text-white font-bold italic">SI</div>
      <div class="flex flex-col"><span class="text-white font-medium text-base">ç®¡ç†ç³»çµ±</span><span class="text-slate-500 text-[10px] tracking-widest uppercase">Admin v4.1</span></div>
    </div>
    <nav class="flex-grow py-8 px-4 space-y-2">
      <button onclick="switchTab('courses')" id="btn-courses" class="sidebar-item active w-full flex items-center px-4 py-3 rounded-lg text-sm font-medium">ğŸ“ èª²ç¨‹è¦æ ¼ç·¨ä¿®</button>
      <button onclick="switchTab('settings')" id="btn-settings" class="sidebar-item w-full flex items-center px-4 py-3 rounded-lg text-sm font-medium">âš™ï¸ ç³»çµ±åƒæ•¸è¨­å®š</button>
    </nav>
  </aside>

  <main class="flex-grow ml-[260px] p-12">
    <section id="section-courses">
      <div class="flex justify-between items-center mb-10">
        <div><h2 class="text-2xl font-semibold text-slate-800 tracking-tight">èª²ç¨‹è¦æ ¼ç·¨ä¿®</h2><p class="text-slate-400 text-sm mt-1 uppercase tracking-widest font-medium">Professional Course Settings</p></div>
        <button onclick="openModal()" class="bg-emerald-500 text-white px-6 py-3 rounded-lg font-medium shadow-lg hover:bg-emerald-600 transition-all text-sm">+ æ–°å¢èª²ç¨‹è¦æ ¼</button>
      </div>
      <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="bg-slate-50 border-b border-slate-100 text-[11px] font-bold text-slate-400 uppercase tracking-wider">
              <th class="px-8 py-5">ç·¨è™Ÿ/é¡åˆ¥</th><th class="px-8 py-5">åç¨±/æ•™ç·´</th><th class="px-8 py-5">å…¨æ—¥/åŠæ—¥å–®åƒ¹</th><th class="px-8 py-5">ç‹€æ…‹</th><th class="px-8 py-5 text-right">ç®¡ç†</th>
            </tr>
          </thead>
          <tbody id="courseTableBody" class="divide-y divide-slate-50 font-medium text-slate-600"></tbody>
        </table>
      </div>
    </section>

    <!-- ç³»çµ±è¨­å®š -->
    <section id="section-settings" class="hidden">
      <h2 class="text-2xl font-semibold text-slate-800 mb-10 italic uppercase">System Parameters</h2>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
        <div class="bg-white p-10 rounded-2xl border border-slate-200 shadow-sm">
          <h3 class="font-semibold text-slate-700 text-lg mb-6">è¨­å‚™ç§Ÿç”¨ç¯„æœ¬å€</h3>
          <div id="global-equip-list" class="space-y-4"></div>
          <button onclick="addGlobalEquip()" class="mt-6 text-xs font-semibold text-emerald-600 border-b border-emerald-200">+ æ–°å¢ç¯„æœ¬é …ç›®</button>
          <button onclick="saveGlobalSettings()" class="w-full mt-10 bg-slate-800 text-white py-4 rounded-xl font-bold tracking-widest hover:bg-slate-900 shadow-lg transition-all">åŒæ­¥å…¨åŸŸåƒæ•¸</button>
        </div>
        <div class="bg-white p-10 rounded-2xl border border-slate-200 shadow-sm">
          <h3 class="font-semibold text-slate-700 text-lg mb-6">å…¨åŸŸé è¨­åŒ¯æ¬¾è³‡è¨Š</h3>
          <textarea id="global-payment" rows="8" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-xl font-medium outline-none text-base leading-relaxed" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ..."></textarea>
        </div>
      </div>
    </section>
  </main>

  <!-- å´æ»‘ç·¨è¼¯å™¨ -->
  <div id="modalOverlay" onclick="closeModal()" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden z-[100]"></div>
  <div id="editModal" class="fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-2xl z-[101] slide-in flex flex-col transition-transform">
    <div class="p-8 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0">
      <h3 class="text-xl font-semibold text-slate-800 uppercase tracking-tighter">Edit Specification</h3>
      <button onclick="closeModal()" class="text-slate-400 text-3xl hover:text-red-500 transition-all">&times;</button>
    </div>
    <form id="courseForm" class="flex-grow overflow-y-auto p-10 space-y-10">
      <!-- Section 1 -->
      <div>
        <label class="label-text">æ ¸å¿ƒè­˜åˆ¥è³‡æ–™</label>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <input type="text" id="f-id" placeholder="èª²ç¨‹ç·¨è™Ÿ (å¦‚: B01)" required class="input-field font-mono font-bold text-indigo-500">
          <select id="f-category" class="input-field"><option value="å–®æ—¥">å–®æ—¥èª²ç¨‹</option><option value="æ¢¯æ¬¡">æ¢¯æ¬¡èª²ç¨‹</option><option value="ç‡ŸéšŠå°ˆå€">ç‡ŸéšŠ</option><option value="èª²å¾Œç­">èª²å¾Œç­</option></select>
          <input type="text" id="f-name" placeholder="èª²ç¨‹ä¸»åç¨±" required class="md:col-span-2 input-field font-medium">
          <input type="text" id="f-batch" placeholder="æ¢¯æ¬¡åç¨± (å¦‚: 2026å¤å­£ A ç­)" class="input-field">
          <input type="text" id="f-coach" placeholder="è² è²¬æ•™ç·´" class="input-field">
        </div>
      </div>
      <!-- Section 2: åƒ¹æ ¼æ™‚é–“ (å¤šæ—¥è¨ˆè²»è¨­å®š) -->
      <div>
        <label class="label-text">å¤šæ—¥ç‡Ÿé‹åƒ¹æ ¼åƒæ•¸ (ä¸å¸¶ç§’)</label>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6 bg-slate-50 border border-slate-100 rounded-xl">
          <div><span class="label-text">æ¨™æº– å…¨æ—¥å–®åƒ¹</span><input type="number" id="f-priceF" class="input-field font-bold"></div>
          <div><span class="label-text">æ¨™æº– åŠæ—¥å–®åƒ¹</span><input type="number" id="f-priceH" class="input-field font-bold"></div>
          <div><span class="label-text text-red-600">æ—©é³¥ å…¨æ—¥å„ªæƒ </span><input type="number" id="f-earlyF" class="input-field border-red-100 font-bold text-red-600"></div>
          <div><span class="label-text text-red-600">æ—©é³¥ åŠæ—¥å„ªæƒ </span><input type="number" id="f-earlyH" class="input-field border-red-100 font-bold text-red-600"></div>
          <div class="md:col-span-2"><span class="label-text text-red-500">æ—©é³¥æˆªæ­¢æ—¥æœŸ</span><input type="date" id="f-earlyDeadline" class="input-field border-red-200"></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
          <div><span class="label-text">é–‹å§‹æ™‚é–“ (ä¾‹: 2026-07-01 09:00)</span><input type="text" id="f-start" class="input-field font-mono text-xs"></div>
          <div><span class="label-text">çµæŸæ™‚é–“ (ä¾‹: 2026-07-05 17:00)</span><input type="text" id="f-end" class="input-field font-mono text-xs"></div>
        </div>
      </div>
      <!-- Section 3 -->
      <div class="p-6 bg-emerald-50/30 border border-emerald-100 rounded-xl">
        <div class="flex justify-between items-center mb-4"><span class="label-text mb-0">èª²ç¨‹å°ˆå±¬è¨­å‚™ç§Ÿç”¨</span><button type="button" onclick="addCourseEquip()" class="text-[10px] font-bold border px-2 py-1 rounded bg-white">+ CUSTOM</button></div>
        <div id="course-equip-list" class="space-y-3"></div>
      </div>
      <!-- Section 4 -->
      <div class="space-y-6">
        <textarea id="f-paymentInfo" placeholder="æŒ‡å®šåŒ¯æ¬¾å¸³è™Ÿ (ç•™ç©ºå‰‡ä½¿ç”¨é è¨­)" rows="2" class="input-field"></textarea>
        <textarea id="f-desc" placeholder="èª²ç¨‹è©³ç´°ä»‹ç´¹ã€æ”œå¸¶ç‰©å“èˆ‡æ³¨æ„äº‹é …" rows="3" class="input-field"></textarea>
        <div class="grid grid-cols-2 gap-6"><input type="number" id="f-limit" placeholder="æ‹›ç”Ÿä¸Šé™" class="input-field"><input type="text" id="f-img" placeholder="åœ–ç‰‡ç¶²å€ (https://...)" class="input-field text-xs"></div>
        <select id="f-status" class="input-field font-bold text-emerald-600"><option value="å ±åä¸­">å ±åä¸­</option><option value="å·²é¡æ»¿">å·²é¡æ»¿</option><option value="åœè¾¦">åœè¾¦</option></select>
      </div>
    </form>
    <div class="p-8 border-t bg-slate-50 flex space-x-4 sticky bottom-0">
      <button onclick="submitForm()" id="saveBtn" class="flex-grow bg-emerald-500 text-white py-4 rounded-xl font-semibold shadow-lg hover:bg-emerald-600 transition-all uppercase tracking-widest">Save Specification</button>
      <button onclick="closeModal()" class="px-8 bg-white text-slate-400 font-medium border rounded-xl hover:bg-gray-50">Cancel</button>
    </div>
  </div>

  <script>
    const API_URL = "https://sport.wetw-net3.workers.dev/";
    let courseList = [];
    let globalConfig = { è¨­å‚™ç¯„æœ¬: [], é è¨­åŒ¯æ¬¾: "" };

    async function init() {
      try {
        const res = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'adminGetData' }) }).then(r => r.json());
        courseList = res.èª²ç¨‹ || [];
        globalConfig = res.è¨­å®š || { è¨­å‚™ç¯„æœ¬: [], é è¨­åŒ¯æ¬¾: "" };
        renderTable();
      } catch(e) { console.error(e); }
    }

    function renderTable() {
      document.getElementById('courseTableBody').innerHTML = courseList.map((c, i) => `
        <tr class="hover:bg-slate-50 transition-all group font-medium">
          <td class="px-8 py-6"><div class="font-mono text-sm text-indigo-400">${c.id}</div><span class="badge cat-${c.category.substring(0,2)} mt-2 inline-block">${c.category}</span></td>
          <td class="px-8 py-6"><div class="text-slate-800 font-semibold text-base">${c.name}</div><div class="text-[11px] text-slate-400 mt-1 uppercase">${c.batch || '-'} | æ•™ç·´: ${c.coach}</div></td>
          <td class="px-8 py-6"><div class="text-xs text-slate-300 font-mono">F:$${c.priceF} | H:$${c.priceH}</div><div class="text-red-500 font-bold text-lg font-mono">E:$${c.earlyF}</div></td>
          <td class="px-8 py-6"><span class="text-[11px] font-semibold ${c.status === 'å ±åä¸­' ? 'text-emerald-500' : 'text-slate-300'} uppercase border-b-2 ${c.status === 'å ±åä¸­' ? 'border-emerald-100' : 'border-slate-100'} pb-1">${c.status}</span></td>
          <td class="px-8 py-6 text-right opacity-0 group-hover:opacity-100 transition-all"><button onclick="editCourse(${i})" class="text-blue-500 text-xs font-semibold mr-4">ç·¨è¼¯</button><button onclick="cloneCourse(${i})" class="text-slate-400 text-xs font-semibold">è¤‡è£½</button></td>
        </tr>`).join('');
    }

    function switchTab(tab) {
      ['courses', 'settings'].forEach(t => {
        document.getElementById('section-' + t).classList.toggle('hidden', t !== tab);
        document.getElementById('btn-' + t).classList.toggle('active', t === tab);
      });
      if(tab === 'settings') renderSettings();
    }

    function openModal() {
      document.getElementById('courseForm').reset();
      document.getElementById('f-id').disabled = false;
      document.getElementById('course-equip-list').innerHTML = "";
      globalConfig.è¨­å‚™ç¯„æœ¬.forEach(e => createEquipRow(document.getElementById('course-equip-list'), e.é …ç›®, e.é‡‘é¡, "f-equip-item"));
      document.getElementById('modalOverlay').classList.remove('hidden');
      document.getElementById('editModal').classList.add('active');
    }

    function closeModal() { document.getElementById('modalOverlay').classList.add('hidden'); document.getElementById('editModal').classList.remove('active'); }

    function editCourse(idx) {
      const c = courseList[idx]; fillForm(c);
      document.getElementById('f-id').disabled = true;
      document.getElementById('modalOverlay').classList.remove('hidden');
      document.getElementById('editModal').classList.add('active');
    }

    function cloneCourse(idx) {
      fillForm(courseList[idx]);
      document.getElementById('f-id').value = courseList[idx].id + "-NEW";
      document.getElementById('f-id').disabled = false;
      document.getElementById('modalOverlay').classList.remove('hidden');
      document.getElementById('editModal').classList.add('active');
    }

    function fillForm(c) {
      document.getElementById('f-id').value = c.id; document.getElementById('f-category').value = c.category;
      document.getElementById('f-name').value = c.name; document.getElementById('f-batch').value = c.batch;
      document.getElementById('f-coach').value = c.coach; document.getElementById('f-start').value = c.start;
      document.getElementById('f-end').value = c.end; 
      document.getElementById('f-priceF').value = c.priceF; document.getElementById('f-priceH').value = c.priceH;
      document.getElementById('f-earlyF').value = c.earlyF; document.getElementById('f-earlyH').value = c.earlyH;
      document.getElementById('f-earlyDeadline').value = c.earlyBirdEnd;
      document.getElementById('f-leaveDeduct').value = c.leaveDeduct; document.getElementById('f-paymentInfo').value = c.paymentInfo;
      document.getElementById('f-desc').value = c.desc; document.getElementById('f-img').value = c.img;
      document.getElementById('f-limit').value = c.limit; document.getElementById('f-status').value = c.status;
      const list = document.getElementById('course-equip-list'); list.innerHTML = "";
      try { JSON.parse(c.equips || "[]").forEach(e => createEquipRow(list, e.é …ç›®, e.é‡‘é¡, "f-equip-item")); } catch(err) {}
    }

    function createEquipRow(container, name = "", price = "", className = "") {
      const div = document.createElement('div');
      div.className = `flex items-center space-x-3 ${className}`;
      div.innerHTML = `<input type="text" placeholder="é …ç›®" value="${name}" class="flex-grow p-3 border rounded-lg text-sm"><input type="number" placeholder="é‡‘é¡" value="${price}" class="w-24 p-3 border rounded-lg text-sm font-bold text-emerald-600"><button type="button" onclick="this.parentElement.remove()" class="text-slate-300 hover:text-red-400 text-xl font-bold px-2">&times;</button>`;
      container.appendChild(div);
    }

    async function submitForm() {
      const btn = document.getElementById('saveBtn'); btn.disabled = true;
      const equips = [];
      document.querySelectorAll('.f-equip-item').forEach(el => {
        const ins = el.querySelectorAll('input'); if(ins[0].value) equips.push({é …ç›®: ins[0].value, é‡‘é¡: Number(ins[1].value)});
      });
      const data = { action: 'adminSaveCourse', id: document.getElementById('f-id').value, category: document.getElementById('f-category').value, name: document.getElementById('f-name').value, batch: document.getElementById('f-batch').value, coach: document.getElementById('f-coach').value, start: document.getElementById('f-start').value, end: document.getElementById('f-end').value, priceF: Number(document.getElementById('f-priceF').value), priceH: Number(document.getElementById('f-priceH').value), earlyF: Number(document.getElementById('f-earlyF').value), earlyH: Number(document.getElementById('f-earlyH').value), earlyBirdEnd: document.getElementById('f-earlyDeadline').value, limit: Number(document.getElementById('f-limit').value), status: document.getElementById('f-status').value, img: document.getElementById('f-img').value, desc: document.getElementById('f-desc').value, leaveDeduct: Number(document.getElementById('f-leaveDeduct').value), equips: JSON.stringify(equips), paymentInfo: document.getElementById('f-paymentInfo').value };
      await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
      alert("å„²å­˜æˆåŠŸ"); init(); closeModal(); btn.disabled = false;
    }

    function renderSettings() {
      document.getElementById('global-payment').value = globalConfig.é è¨­åŒ¯æ¬¾;
      const list = document.getElementById('global-equip-list'); list.innerHTML = "";
      globalConfig.è¨­å‚™ç¯„æœ¬.forEach(e => createEquipRow(list, e.é …ç›®, e.é‡‘é¡, "g-equip-item"));
    }

    async function saveGlobalSettings() {
      const template = [];
      document.querySelectorAll('.g-equip-item').forEach(el => { const ins = el.querySelectorAll('input'); if(ins[0].value) template.push({é …ç›®: ins[0].value, é‡‘é¡: Number(ins[1].value)}); });
      const data = { action: 'adminSaveSettings', è¨­å‚™ç¯„æœ¬: JSON.stringify(template), é è¨­åŒ¯æ¬¾: document.getElementById('global-payment').value };
      await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
      alert("å…¨åŸŸåƒæ•¸æ›´æ–°æˆåŠŸ"); init();
    }
    function addGlobalEquip() { createEquipRow(document.getElementById('global-equip-list'), "", 0, "g-equip-item"); }
    function addCourseEquip() { createEquipRow(document.getElementById('course-equip-list'), "", 0, "f-equip-item"); }
    window.onload = init;
  </script>
</body>
</html>
